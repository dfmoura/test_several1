<gadget>
  <prompt-parameters>
    <parameter id="P_PERIODO" description="Periodo" metadata="singleList:Text" listType="sql" required="false" keep-last="true" keep-date="false" order="1">
      <expression type="SQL"><![CDATA[SELECTTO_CHAR(DTMOV,'YYYY') AS VALUE,TO_CHAR(DTMOV,'YYYY') AS LABELFROM TGFCABGROUP BYTO_CHAR(DTMOV,'YYYY')ORDER BYTO_CHAR(DTMOV,'YYYY') DESC]]></expression>
    </parameter>
    <parameter id="P_PERIODO2" description="Periodo 2" metadata="singleList:Text" listType="sql" required="false" keep-last="true" keep-date="false" order="2">
      <expression type="SQL"><![CDATA[SELECTTO_CHAR(DTMOV,'YYYY') AS VALUE,TO_CHAR(DTMOV,'YYYY') AS LABELFROM TGFCABGROUP BYTO_CHAR(DTMOV,'YYYY')ORDER BYTO_CHAR(DTMOV,'YYYY') DESC]]></expression>
    </parameter>
  </prompt-parameters>
  <level id="lvl_aj3y70r" description="Principal">
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="H" tamanhoRelativo="261">
        <container orientacao="V" tamanhoRelativo="311">
          <chart id="cht_apxkdrj" type="line" nroColuna="12">
            <title><![CDATA[<b>EVOLUÇÃO REAL x PREVISTO >>> :P_PERIODO</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTANO,MES,MES_ANO,ABS(PREV) AS PREV,ABS(REAL) AS REALFROM(SELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END)AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOAND ORC.CODIGO IS NOT NULL --AND (ORC.CALCFAT = 'N' OR ORC.CALCFAT IS NULL)GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')AND ORC.CODIGO IS NOT NULL AND (ORC.CALCFAT = 'N' OR ORC.CALCFAT IS NULL)GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANO)GROUP BY ANO,MES,MES_ANO,PREV,REALORDER BY ANO,MES]]></expression>
            <metadata>
              <field name="ANO" label="ANO" type="S" visible="true" useFooter="false"/>
              <field name="MES" label="MES" type="S" visible="true" useFooter="false"/>
              <field name="MES_ANO" label="Mês / Ano" type="S" visible="true" useFooter="false"/>
              <field name="PREV" label="Previsto" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              <field name="REAL" label="Real" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            </metadata>
            <horizontal-axis>
              <category field="MES_ANO" rotation="-53" dropLabel="false">
                <initView value="first"/>
              </category>
            </horizontal-axis>
            <series>
              <serie type="line" circle-intersection="true">
                <xField>MES_ANO</xField>
                <yField>PREV</yField>
                <display><![CDATA[Previsto]]></display>
                <color>0xff0000</color>
              </serie>
              <serie type="line" circle-intersection="true">
                <xField>MES_ANO</xField>
                <yField>REAL</yField>
                <display><![CDATA[Real]]></display>
                <color>0xcc</color>
              </serie>
            </series>
            <legend position="top" direction="v"/>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="100">
          <chart id="cht_apxkdwp" type="gauge">
            <title><![CDATA[<b>% de Atendimento Orçamento</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCASE WHEN ABS(SUM(PREV)) = 0 THEN 100 ELSE ABS(SUM(REAL)) * 100 / NULLIF(ABS(SUM(PREV)), 0) END AS PERC_ATINGIDOFROM(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOAND ORC.CODIGO IS NOT NULL --AND (ORC.CALCFAT = 'N' OR ORC.CALCFAT IS NULL)GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')AND ORC.CODIGO IS NOT NULL AND (ORC.CALCFAT = 'N' OR ORC.CALCFAT IS NULL)GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY'))]]></expression>
            <metadata>
              <field name="PERC_ATINGIDO" label="% Atingido" type="F" visible="true" useFooter="false"/>
            </metadata>
            <show-ticks>true</show-ticks>
            <min-value>0</min-value>
            <max-value>100</max-value>
            <value-field>PERC_ATINGIDO</value-field>
            <alert-colors values="0,30,50,70,90,100" colors="0xff00,0xff9900,0xffff,0xff,0xff0000"/>
          </chart>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="422">
        <container orientacao="V" tamanhoRelativo="116">
          <chart id="cht_apxkdym" type="column" nroColuna="10">
            <title><![CDATA[<b>Naturezas cujo valor REAL ultrapassou o PREVISTO</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[WITH FIN AS(SELECTFIN.CODNAT,0 AS PREV,ABS(NVL(SUM(FIN.VLRBAIXA),0)) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYFIN.CODNAT),NAT AS (SELECT CODNAT,DESCRNAT FROM TGFNAT)SELECT MET.CODNAT,NAT.DESCRNAT,ABS(SUM(PREVREC - PREVDESP)) AS PREV,NVL(FIN.REAL,0) AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATLEFT JOIN FIN ON MET.CODNAT = FIN.CODNATINNER JOIN NAT ON MET.CODNAT = NAT.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYMET.CODNAT,NAT.DESCRNAT,FIN.REALORDER BY NVL(FIN.REAL,0) DESC]]></expression>
            <metadata>
              <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
              <field name="DESCRNAT" label="Natureza" type="S" visible="true" useFooter="false"/>
              <field name="PREV" label="Previsto" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              <field name="REAL" label="Real" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            </metadata>
            <horizontal-axis>
              <category field="DESCRNAT" rotation="-47" dropLabel="true">
                <initView value="first"/>
                <title>Natureza</title>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>DESCRNAT</xField>
                <yField>PREV</yField>
                <display><![CDATA[Previsto]]></display>
                <color>0xff0000</color>
              </serie>
              <serie type="column">
                <xField>DESCRNAT</xField>
                <yField>REAL</yField>
                <display><![CDATA[Real]]></display>
                <color>0xff</color>
              </serie>
            </series>
            <legend position="top" direction="v"/>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="100">
          <chart id="cht_aquvtyb" type="column" nroColuna="6">
            <title><![CDATA[<b>TA 30% PARA ATINGIR PREVISTO</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODNAT,ABS(SUM(PREV)) AS PREV,ABS(SUM(REAL)) AS REALFROM(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT MET.CODNAT,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYMET.CODNATUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTFIN.CODNAT,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')AND (ORC.CALCFAT = 'N' OR ORC.CALCFAT IS NULL)GROUP BYFIN.CODNAT)WHERE ABS(PREV) > 0 AND REAL/PREV BETWEEN 0.7 AND 1GROUP BY CODNATORDER BY CODNAT]]></expression>
            <metadata>
              <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
              <field name="PREV" label="Previsto" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              <field name="REAL" label="Real" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            </metadata>
            <horizontal-axis>
              <category field="CODNAT" rotation="-45" dropLabel="false">
                <initView value="first"/>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>CODNAT</xField>
                <yField>PREV</yField>
                <display><![CDATA[Previsto]]></display>
                <color>0xff0000</color>
              </serie>
              <serie type="column">
                <xField>CODNAT</xField>
                <yField>REAL</yField>
                <display><![CDATA[Real]]></display>
                <color>0xff</color>
              </serie>
            </series>
            <legend position="top" direction="v"/>
          </chart>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="100">
        <container orientacao="V" tamanhoRelativo="33">
          <simple-value id="svl_apxkdyl">
            <value-expression><![CDATA[<div style='text-align: center;'><button style="background-color: #4CAF50; color: white; padding: 10px;">Análise do Orçamento</button></div>]]></value-expression>
            <on-click navigate-to="lvl_apxkdqg"/>
          </simple-value>
        </container>
        <container orientacao="V" tamanhoRelativo="33">
          <simple-value id="svl_apxkdy8">
            <value-expression><![CDATA[<div style='text-align: center;'><button style="background-color: #4CAF50; color: white; padding: 10px;">Comparação do Orçamento</button></div>]]></value-expression>
            <on-click navigate-to="lvl_at0vt85"/>
          </simple-value>
        </container>
        <container orientacao="V" tamanhoRelativo="33">
          <simple-value id="svl_atqh7n8">
            <value-expression><![CDATA[<div style='text-align: center;'><button style="background-color: #4CAF50; color: white; padding: 10px;">Evolução Geral Orçamento</button></div>]]></value-expression>
            <on-click navigate-to="lvl_atqh7ol"/>
          </simple-value>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_apxkdqg" description="Nivel1">
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_apxkdqt" useNewGrid="S">
        <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODIGO1,DESCRICAO,GRAU,JAN_P,JAN_R,JAN_PERC,FEV_P,FEV_R,FEV_PERC,MAR_P,MAR_R,MAR_PERC,ABR_P,ABR_R,ABR_PERC,MAI_P,MAI_R,MAI_PERC,JUN_P,JUN_R,JUN_PERC,JUL_P,JUL_R,JUL_PERC,AGO_P,AGO_R,AGO_PERC,SET_P,SET_R,SET_PERC,OUT_P,OUT_R,OUT_PERC,NOV_P,NOV_R,NOV_PERC,DEZ_P,DEZ_R,DEZ_PERC,JAN_P + FEV_P + MAR_P + ABR_P + MAI_P + JUN_P + JUL_P + AGO_P + SET_P + OUT_P + NOV_P + DEZ_P AS TTL_PREV,JAN_R + FEV_R + MAR_R + ABR_R + MAI_R + JUN_R + JUL_R + AGO_R + SET_R + OUT_R + NOV_R + DEZ_R AS TTL_REAL,CASE WHEN GRAU = 1 THEN '#8EA9DB' WHEN GRAU = 2 THEN '#c6d4ed'WHEN GRAU = 3 THEN '#dde5f4'WHEN GRAU = 4 THEN '#e8f5cc'WHEN GRAU = 5 THEN '#f0eaf5'WHEN GRAU IS NULL THEN '#2e34db'END AS BKCOLOR,CASE WHEN GRAU IS NULL THEN '#fafafc'END AS FGCOLORFROM(SELECTCODIGO1,DESCRICAO,GRAU,MAX(CASE WHEN MES = '01' THEN PREV END) AS "JAN_P",MAX(NVL(CASE WHEN MES = '01' THEN REAL END, 0)) AS "JAN_R",MAX(NVL(CASE WHEN MES = '01' THEN PERC END, 0)) AS "JAN_PERC",MAX(CASE WHEN MES = '02' THEN PREV END) AS "FEV_P",MAX(NVL(CASE WHEN MES = '02' THEN REAL END, 0)) AS "FEV_R",MAX(NVL(CASE WHEN MES = '02' THEN PERC END, 0)) AS "FEV_PERC",MAX(CASE WHEN MES = '03' THEN PREV END) AS "MAR_P",MAX(NVL(CASE WHEN MES = '03' THEN REAL END, 0)) AS "MAR_R",MAX(NVL(CASE WHEN MES = '03' THEN PERC END, 0)) AS "MAR_PERC",MAX(CASE WHEN MES = '04' THEN PREV END) AS "ABR_P",MAX(NVL(CASE WHEN MES = '04' THEN REAL END, 0)) AS "ABR_R",MAX(NVL(CASE WHEN MES = '04' THEN PERC END, 0)) AS "ABR_PERC",MAX(CASE WHEN MES = '05' THEN PREV END) AS "MAI_P",MAX(NVL(CASE WHEN MES = '05' THEN REAL END, 0)) AS "MAI_R",MAX(NVL(CASE WHEN MES = '05' THEN PERC END, 0)) AS "MAI_PERC",MAX(CASE WHEN MES = '06' THEN PREV END) AS "JUN_P",MAX(NVL(CASE WHEN MES = '06' THEN REAL END, 0)) AS "JUN_R",MAX(NVL(CASE WHEN MES = '06' THEN PERC END, 0)) AS "JUN_PERC",MAX(CASE WHEN MES = '07' THEN PREV END) AS "JUL_P",MAX(NVL(CASE WHEN MES = '07' THEN REAL END, 0)) AS "JUL_R",MAX(NVL(CASE WHEN MES = '07' THEN PERC END, 0)) AS "JUL_PERC",MAX(CASE WHEN MES = '08' THEN PREV END) AS "AGO_P",MAX(NVL(CASE WHEN MES = '08' THEN REAL END, 0)) AS "AGO_R",MAX(NVL(CASE WHEN MES = '08' THEN PERC END, 0)) AS "AGO_PERC",MAX(CASE WHEN MES = '09' THEN PREV END) AS "SET_P",MAX(NVL(CASE WHEN MES = '09' THEN REAL END, 0)) AS "SET_R",MAX(NVL(CASE WHEN MES = '09' THEN PERC END, 0)) AS "SET_PERC",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_P",MAX(NVL(CASE WHEN MES = '10' THEN REAL END, 0)) AS "OUT_R",MAX(NVL(CASE WHEN MES = '10' THEN PERC END, 0)) AS "OUT_PERC",MAX(CASE WHEN MES = '11' THEN PREV END) AS "NOV_P",MAX(NVL(CASE WHEN MES = '11' THEN REAL END, 0)) AS "NOV_R",MAX(NVL(CASE WHEN MES = '11' THEN PERC END, 0)) AS "NOV_PERC",MAX(CASE WHEN MES = '12' THEN PREV END) AS "DEZ_P",MAX(NVL(CASE WHEN MES = '12' THEN REAL END, 0)) AS "DEZ_R",MAX(NVL(CASE WHEN MES = '12' THEN PERC END, 0)) AS "DEZ_PERC"FROM(WITH B AS (SELECT LPAD(CODIGO, 10, '0') AS CODIGO1, DESCRICAO,GRAU FROM AD_ORCFIN)SELECTA.ANO,A.MES,A.MES_ANO,A.CODIGO1,CASEWHEN A.CODIGO1 LIKE '0499999999' THEN 'MARGEM DE CONTRIBUIÇÃO'WHEN A.CODIGO1 LIKE '0599999999' THEN 'LUCRO OPERACIONAL ANTES DOS INVESTIMENTOS'WHEN A.CODIGO1 LIKE '0699999998' THEN 'DESPESA OPERACIONAL TOTAL'WHEN A.CODIGO1 LIKE '0699999999' THEN 'LUCRO OPERACIONAL'WHEN A.CODIGO1 LIKE '0799999999' THEN 'RESULTADO LÍQUIDO'WHEN A.CODIGO1 LIKE '0899999998' THEN 'DISTRIBUIÇÃO PARA SÓCIOS'WHEN A.CODIGO1 LIKE '0899999999' THEN 'REINVESTIMENTO GRUPO SATIS'ELSE B.DESCRICAO END AS DESCRICAO, B.GRAU,A.PREV,A.REAL,(A.REAL / MAX(A.REAL) OVER (PARTITION BY A.MES))*100 AS PERCFROM(SELECTANO,MES,MES_ANO,GRAU,CODIGO1,SUM(PREV) AS PREV,SUM(REAL) AS REALFROM(WITH BAS AS(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'WHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANO,GRAU,CODIGO1/* TOTALIZADORES */UNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0499999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FININNER JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATINNER JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0599999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0799999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END)AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANO) ALEFT JOIN B ON A.CODIGO1 = B.CODIGO1GROUP BYA.ANO,A.MES,A.MES_ANO,A.CODIGO1,B.DESCRICAO,B.GRAU, A.PREV,A.REAL)GROUP BY CODIGO1,DESCRICAO,GRAU)ORDER BY CODIGO1]]></expression>
        <metadata>
          <field name="CODIGO1" label="Código" type="S" visible="true" useFooter="false"/>
          <field name="DESCRICAO" label="Descrição" type="S" visible="true" useFooter="false"/>
          <field name="GRAU" label="Grau" type="S" visible="true" useFooter="false"/>
          <field name="JAN_P" label="JAN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JAN_R" label="JAN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JAN_PERC" label="JAN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="FEV_P" label="FEV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="FEV_R" label="FEV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="FEV_PERC" label="FEV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="MAR_P" label="MAR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAR_R" label="MAR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAR_PERC" label="MAR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="ABR_P" label="ABR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="ABR_R" label="ABR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="ABR_PERC" label="ABR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="MAI_P" label="MAI. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAI_R" label="MAI. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAI_PERC" label="MAI. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="JUN_P" label="JUN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUN_R" label="JUN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUN_PERC" label="JUN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="JUL_P" label="JUL. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUL_R" label="JUL. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUL_PERC" label="JUL. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="AGO_P" label="AGO. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="AGO_R" label="AGO. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="AGO_PERC" label="AGO. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="SET_P" label="SET. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="SET_R" label="SET. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="SET_PERC" label="SET. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="OUT_P" label="OUT. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="OUT_R" label="OUT. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="OUT_PERC" label="OUT. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="NOV_P" label="NOV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="NOV_R" label="NOV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="NOV_PERC" label="NOV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="DEZ_P" label="DEZ. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="DEZ_R" label="DEZ. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="DEZ_PERC" label="DEZ. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="TTL_PREV" label="Total PREV." type="F" visible="true" useFooter="null" mask="#.##0,00">
            <formatter greaterEqualThan="0"><![CDATA[<span style="; background-color:#33FF00">
  <b>$VALUE</b>
</span>]]></formatter>
          </field>
          <field name="TTL_REAL" label="Total REAL" type="F" visible="true" useFooter="false" mask="#.##0,00">
            <formatter greaterEqualThan="0"><![CDATA[<span style="; background-color:#33FF00">
  <b>$VALUE</b>
</span>]]></formatter>
          </field>
          <field name="BKCOLOR" label="BKCOLOR" type="S" visible="true" useFooter="false"/>
          <field name="FGCOLOR" label="FGCOLOR" type="S" visible="true" useFooter="false"/>
        </metadata>
        <on-click navigate-to="lvl_asj889p">
          <param id="A_CODIGO">$CODIGO1</param>
        </on-click>
      </grid>
    </container>
  </level>
  <level id="lvl_asj889p" description="Nivel 2">
    <args>
      <arg id="A_CODIGO" type="text"/>
      <arg id="A_CODNAT" type="integer"/>
      <arg id="A_DESCRNAT" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="928">
        <grid id="grd_asj889q" useNewGrid="S">
          <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODNAT,DESCRNAT, CODCENCUS,DESCRCENCUS, CODPROJ,IDENTIFICACAO,NVL(JAN_R,0) AS JAN_R,NVL(FEV_R,0) AS FEV_R,NVL(MAR_R,0) AS MAR_R,NVL(ABR_R,0) AS ABR_R,NVL(MAI_R,0) AS MAI_R,NVL(JUN_R,0) AS JUN_R,NVL(JUL_R,0) AS JUL_R,NVL(AGO_R,0) AS AGO_R,NVL(SET_R,0) AS SET_R,NVL(OUT_R,0) AS OUT_R,NVL(NOV_R,0) AS NOV_R,NVL(DEZ_R,0) AS DEZ_R,NVL(JAN_R,0)+NVL(FEV_R,0)+NVL(MAR_R,0)+NVL(ABR_R,0)+NVL(MAI_R,0)+NVL(JUN_R,0)+NVL(JUL_R,0)+NVL(AGO_R,0)+NVL(SET_R,0)+NVL(OUT_R,0)+NVL(NOV_R,0)+NVL(DEZ_R,0) AS TTL_REALFROM(WITH B AS (SELECT LPAD(CODIGO, 10, '0') AS CODIGO1, DESCRICAO,GRAU FROM AD_ORCFIN),NAT AS (SELECT CODNAT,DESCRNAT FROM TGFNAT),CRE AS (SELECT CODCENCUS, DESCRCENCUS FROM TSICUS),PROJ AS (SELECT CODPROJ, IDENTIFICACAO FROM TCSPRJ)SELECTA.CODNAT,NAT.DESCRNAT, A.CODCENCUS,CRE.DESCRCENCUS, A.CODPROJ,PROJ.IDENTIFICACAO,MAX(CASE WHEN MES = '01' THEN REAL END) AS "JAN_R",MAX(CASE WHEN MES = '02' THEN REAL END) AS "FEV_R",MAX(CASE WHEN MES = '03' THEN REAL END) AS "MAR_R",MAX(CASE WHEN MES = '04' THEN REAL END) AS "ABR_R",MAX(CASE WHEN MES = '05' THEN REAL END) AS "MAI_R",MAX(CASE WHEN MES = '06' THEN REAL END) AS "JUN_R",MAX(CASE WHEN MES = '07' THEN REAL END) AS "JUL_R",MAX(CASE WHEN MES = '08' THEN REAL END) AS "AGO_R",MAX(CASE WHEN MES = '09' THEN REAL END) AS "SET_R",MAX(CASE WHEN MES = '10' THEN REAL END) AS "OUT_R",MAX(CASE WHEN MES = '11' THEN REAL END) AS "NOV_R",MAX(CASE WHEN MES = '12' THEN REAL END) AS "DEZ_R"FROM(WITH BAS AS(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,DET.CODNAT,0 AS CODCENCUS,0 AS CODPROJ,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,DET.CODNAT,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,CAB.CODNAT,CAB.CODCENCUS,CAB.CODPROJ,TO_CHAR(CAB.DTMOV,'YYYY') AS ANO,TO_CHAR(CAB.DTMOV,'MM') AS MES,TO_CHAR(CAB.DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'WHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(CAB.DTMOV,'YYYY'),TO_CHAR(CAB.DTMOV,'MM'),TO_CHAR(CAB.DTMOV,'MM-YYYY'),ORC.CODIGO,CAB.CODNAT,CAB.CODCENCUS,CAB.CODPROJUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,FIN.CODNAT,FIN.CODCENCUS,FIN.CODPROJ,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,FIN.CODNAT,FIN.CODCENCUS,FIN.CODPROJ,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 1' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), CODNAT, CODCENCUS, CODPROJ,PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)ALEFT JOIN B ON A.CODIGO1 = B.CODIGO1INNER JOIN NAT ON A.CODNAT = NAT.CODNATINNER JOIN CRE ON A.CODCENCUS = CRE.CODCENCUSINNER JOIN PROJ ON A.CODPROJ = PROJ.CODPROJWHERE A.CODIGO1 NOT IN ('00','0000','000000','00000000')AND  A.CODCENCUS > 0AND A.CODIGO1 = :A_CODIGOGROUP BYA.CODNAT,NAT.DESCRNAT, A.CODCENCUS,CRE.DESCRCENCUS, A.CODPROJ,PROJ.IDENTIFICACAO)ORDER BY CODNAT]]></expression>
          <metadata>
            <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
            <field name="DESCRNAT" label="Natureza" type="S" visible="true" useFooter="false"/>
            <field name="CODCENCUS" label="Cód. CR" type="I" visible="true" useFooter="false"/>
            <field name="DESCRCENCUS" label="CR" type="S" visible="true" useFooter="false"/>
            <field name="CODPROJ" label="Cód. Proj." type="I" visible="true" useFooter="false"/>
            <field name="IDENTIFICACAO" label="Projeto" type="S" visible="true" useFooter="false"/>
            <field name="JAN_R" label="JAN REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="FEV_R" label="FEV REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="MAR_R" label="MAR REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="ABR_R" label="ABR REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="MAI_R" label="MAI REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="JUN_R" label="JUN REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="JUL_R" label="JUL REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="AGO_R" label="AGO REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="SET_R" label="SET REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="OUT_R" label="OUT REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="NOV_R" label="NOV REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="DEZ_R" label="DEZ REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="TTL_REAL" label="Total Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          </metadata>
          <on-click navigate-to="lvl_asj89c7">
            <param id="A_CODNAT">$CODNAT</param>
            <param id="A_CODCENCUS">$CODCENCUS</param>
            <param id="A_CODPROJ">$CODPROJ</param>
          </on-click>
          <refresh-details ui-list="svl_atqh7k1">
            <param id="A_CODNAT">$CODNAT</param>
            <param id="A_DESCRNAT">$DESCRNAT</param>
          </refresh-details>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <simple-value id="svl_atqh7k1">
          <args>
            <arg id="A_CODNAT" type="integer"/>
            <arg id="A_DESCRNAT" type="text"/>
          </args>
          <value-expression><![CDATA[<div style='text-align: center;'><button style="background-color: #4CAF50; color: white; padding: 10px;">Evolução por Natureza</button></div>]]></value-expression>
          <on-click navigate-to="lvl_atqh7js">
            <param id="A_CODNAT">:A_CODNAT</param>
            <param id="A_DESCRNAT">:A_DESCRNAT</param>
          </on-click>
        </simple-value>
      </container>
    </container>
  </level>
  <level id="lvl_asj89c7" description="Nivel 3">
    <args>
      <arg id="A_CODNAT" type="integer"/>
      <arg id="A_CODCENCUS" type="integer"/>
      <arg id="A_CODPROJ" type="integer"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="100">
        <grid id="grd_asj89c8" useNewGrid="S">
          <expression type="sql" data-source="MGEDS"><![CDATA[SELECTTO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,FIN.*FROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')AND FIN.CODNAT = :A_CODNATAND FIN.CODCENCUS = :A_CODCENCUSAND FIN.CODPROJ = :A_CODPROJORDER BY FIN.DHBAIXA]]></expression>
          <metadata>
            <field name="ANO" label="ANO" type="S" visible="false" useFooter="false"/>
            <field name="MES" label="MES" type="S" visible="false" useFooter="false"/>
            <field name="MES_ANO" label="Mês / Ano" type="S" visible="true" useFooter="false"/>
            <field name="ORIGEM" label="Origem" type="S" visible="true" useFooter="false"/>
            <field name="RECDESP" label="Rec. / Desp." type="I" visible="true" useFooter="false"/>
            <field name="NUFIN" label="NÚ. Fin." type="I" visible="true" useFooter="false"/>
            <field name="NUMNOTA" label="Nro. Nota" type="I" visible="true" useFooter="false"/>
            <field name="PROVISAO" label="Provisão" type="S" visible="true" useFooter="false"/>
            <field name="CODEMP" label="Cód. Emp." type="I" visible="true" useFooter="false"/>
            <field name="DTNEG" label="Dt. Neg." type="D" visible="true" useFooter="false"/>
            <field name="DTENTSAI" label="Dt. Ent. Sai." type="D" visible="true" useFooter="false"/>
            <field name="DTVENC" label="Dt. Venc." type="D" visible="true" useFooter="false"/>
            <field name="DHBAIXA" label="Dh. Baixa" type="D" visible="true" useFooter="false"/>
            <field name="CODPARC" label="Cód. Parc." type="I" visible="true" useFooter="false"/>
            <field name="NOMEPARC" label="Parceiro" type="S" visible="true" useFooter="false"/>
            <field name="CODCENCUS" label="CR" type="I" visible="true" useFooter="false"/>
            <field name="CODCENCUSPAI" label="CR Pai" type="I" visible="true" useFooter="false"/>
            <field name="GRAU" label="Grau" type="I" visible="true" useFooter="false"/>
            <field name="DESCRCENCUS" label="Desc. CR" type="S" visible="true" useFooter="false"/>
            <field name="CODNAT" label="Nat." type="I" visible="true" useFooter="false"/>
            <field name="DESCRNAT" label="Descr. Nat." type="S" visible="true" useFooter="false"/>
            <field name="CODPROJ" label="Proj." type="I" visible="true" useFooter="false"/>
            <field name="IDENTIFICACAO" label="Identificação" type="S" visible="true" useFooter="false"/>
            <field name="ABREVIATURA" label="Abrev." type="S" visible="true" useFooter="false"/>
            <field name="GRAUPRJ" label="Grau Proj." type="I" visible="true" useFooter="false"/>
            <field name="CODPROJPAI" label="Cód. Proj. Pai" type="I" visible="true" useFooter="false"/>
            <field name="ANALITICO_PRJ" label="Cód. Ana. Proj." type="S" visible="true" useFooter="false"/>
            <field name="HISTORICO" label="Histórico" type="S" visible="true" useFooter="false"/>
            <field name="VLRDESDOB" label="Vlr. Desdob." type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="VLRJURO" label="Vlr. Juro" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="VLRMULTA" label="Vlr. Multa" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="VLRDESC" label="Vlr. Desc." type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="VLRBAIXA" label="Vlr. Baixa" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
            <field name="CODTIPOPER" label="Cód. TOP" type="I" visible="true" useFooter="false"/>
            <field name="DESCROPER" label="Descr. TOP" type="S" visible="true" useFooter="false"/>
          </metadata>
          <on-click navigate-to="lvl_atqh7js">
            <param id="A_CODNAT"/>
          </on-click>
        </grid>
      </container>
    </container>
  </level>
  <level id="lvl_atqh7js" description="Nivel 4">
    <args>
      <arg id="A_CODNAT" type="integer"/>
      <arg id="A_DESCRNAT" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <chart id="cht_atqh7jt" type="line" nroColuna="12">
        <title><![CDATA[<b>EVOLUÇÃO POR NATUREZA - :A_CODNAT - :A_DESCRNAT >>> :P_PERIODO </b>]]></title>
        <expression type="sql" data-source="MGEDS"><![CDATA[SELECT ANO,MES,MES_ANO,CODNAT,SUM(PREV)AS PREV,SUM(REAL) AS REALFROM(SELECTTO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,FIN.CODNAT,0 AS PREV,ABS(SUM(FIN.VLRBAIXA)) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')AND FIN.CODNAT = :A_CODNATGROUP BYTO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY'),FIN.CODNATUNION ALL /*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,MET.CODNAT,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOAND MET.CODNAT = :A_CODNATGROUP BYMET.CODNAT,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY'))GROUP BY ANO,MES,MES_ANO,CODNATORDER BY ANO,MES]]></expression>
        <metadata>
          <field name="ANO" label="ANO" type="S" visible="true" useFooter="false"/>
          <field name="MES" label="MES" type="S" visible="true" useFooter="false"/>
          <field name="MES_ANO" label="Mês / Ano" type="S" visible="true" useFooter="false"/>
          <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
          <field name="PREV" label="PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="REAL" label="REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
        </metadata>
        <horizontal-axis>
          <category field="Cód. Nat." rotation="0" dropLabel="false">
            <initView value="first"/>
          </category>
        </horizontal-axis>
        <series>
          <serie type="line" circle-intersection="true">
            <xField>MES_ANO</xField>
            <yField>REAL</yField>
            <display><![CDATA[Real]]></display>
            <color>0xff</color>
          </serie>
          <serie type="line" circle-intersection="true">
            <xField>MES_ANO</xField>
            <yField>PREV</yField>
            <display><![CDATA[Previsto]]></display>
            <color>0xff0000</color>
          </serie>
        </series>
        <legend position="top" direction="v"/>
      </chart>
    </container>
  </level>
  <level id="lvl_atqh7ol" description="Nivel 5">
    <container orientacao="V" tamanhoRelativo="100">
      <chart id="cht_atqh7on" type="line" nroColuna="12">
        <title><![CDATA[<b>EVOLUÇÃO GERAL ORÇAMENTO >>> :P_PERIODO </b>]]></title>
        <expression type="sql" data-source="MGEDS"><![CDATA[SELECT ANO,MES,MES_ANO,SUM(PREV)AS PREV,SUM(REAL) AS REALFROM(SELECTTO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,FIN.CODNAT,0 AS PREV,ABS(SUM(FIN.VLRBAIXA)) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYTO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY'),FIN.CODNATUNION ALL /*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,MET.CODNAT,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYMET.CODNAT,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY'))GROUP BY ANO,MES,MES_ANOORDER BY ANO,MES]]></expression>
        <metadata>
          <field name="ANO" label="ANO" type="S" visible="true" useFooter="false"/>
          <field name="MES" label="MES" type="S" visible="true" useFooter="false"/>
          <field name="MES_ANO" label="Mês / Ano" type="S" visible="true" useFooter="false"/>
          <field name="PREV" label="PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="REAL" label="REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
        </metadata>
        <horizontal-axis>
          <category field="" rotation="0" dropLabel="false">
            <initView value="first"/>
          </category>
        </horizontal-axis>
        <series>
          <serie type="line" circle-intersection="true">
            <xField>MES_ANO</xField>
            <yField>REAL</yField>
            <display><![CDATA[Real]]></display>
            <color>0xff</color>
          </serie>
          <serie type="line" circle-intersection="true">
            <xField>MES_ANO</xField>
            <yField>PREV</yField>
            <display><![CDATA[Previsto]]></display>
            <color>0xff0000</color>
          </serie>
        </series>
        <legend position="top" direction="v"/>
      </chart>
    </container>
  </level>
  <level id="lvl_at0vt85" description="Nivel 6">
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="50">
        <grid id="grd_at0vt9k" useNewGrid="S">
          <title><![CDATA[<b>Planejamento Orçamento - Periodo: :P_PERIODO </b>]]></title>
          <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODIGO1,DESCRICAO,GRAU,JAN_P,JAN_R,JAN_PERC,FEV_P,FEV_R,FEV_PERC,MAR_P,MAR_R,MAR_PERC,ABR_P,ABR_R,ABR_PERC,MAI_P,MAI_R,MAI_PERC,JUN_P,JUN_R,JUN_PERC,JUL_P,JUL_R,JUL_PERC,AGO_P,AGO_R,AGO_PERC,SET_P,SET_R,SET_PERC,OUT_P,OUT_R,OUT_PERC,NOV_P,NOV_R,NOV_PERC,DEZ_P,DEZ_R,DEZ_PERC,JAN_P + FEV_P + MAR_P + ABR_P + MAI_P + JUN_P + JUL_P + AGO_P + SET_P + OUT_P + NOV_P + DEZ_P AS TTL_PREV,JAN_R + FEV_R + MAR_R + ABR_R + MAI_R + JUN_R + JUL_R + AGO_R + SET_R + OUT_R + NOV_R + DEZ_R AS TTL_REAL,CASE WHEN GRAU = 1 THEN '#8EA9DB' WHEN GRAU = 2 THEN '#c6d4ed'WHEN GRAU = 3 THEN '#dde5f4'WHEN GRAU = 4 THEN '#e8f5cc'WHEN GRAU = 5 THEN '#f0eaf5'WHEN GRAU IS NULL THEN '#2e34db'END AS BKCOLOR,CASE WHEN GRAU IS NULL THEN '#fafafc'END AS FGCOLORFROM(SELECTCODIGO1,DESCRICAO,GRAU,MAX(CASE WHEN MES = '01' THEN PREV END) AS "JAN_P",MAX(NVL(CASE WHEN MES = '01' THEN REAL END, 0)) AS "JAN_R",MAX(NVL(CASE WHEN MES = '01' THEN PERC END, 0)) AS "JAN_PERC",MAX(CASE WHEN MES = '02' THEN PREV END) AS "FEV_P",MAX(NVL(CASE WHEN MES = '02' THEN REAL END, 0)) AS "FEV_R",MAX(NVL(CASE WHEN MES = '02' THEN PERC END, 0)) AS "FEV_PERC",MAX(CASE WHEN MES = '03' THEN PREV END) AS "MAR_P",MAX(NVL(CASE WHEN MES = '03' THEN REAL END, 0)) AS "MAR_R",MAX(NVL(CASE WHEN MES = '03' THEN PERC END, 0)) AS "MAR_PERC",MAX(CASE WHEN MES = '04' THEN PREV END) AS "ABR_P",MAX(NVL(CASE WHEN MES = '04' THEN REAL END, 0)) AS "ABR_R",MAX(NVL(CASE WHEN MES = '04' THEN PERC END, 0)) AS "ABR_PERC",MAX(CASE WHEN MES = '05' THEN PREV END) AS "MAI_P",MAX(NVL(CASE WHEN MES = '05' THEN REAL END, 0)) AS "MAI_R",MAX(NVL(CASE WHEN MES = '05' THEN PERC END, 0)) AS "MAI_PERC",MAX(CASE WHEN MES = '06' THEN PREV END) AS "JUN_P",MAX(NVL(CASE WHEN MES = '06' THEN REAL END, 0)) AS "JUN_R",MAX(NVL(CASE WHEN MES = '06' THEN PERC END, 0)) AS "JUN_PERC",MAX(CASE WHEN MES = '07' THEN PREV END) AS "JUL_P",MAX(NVL(CASE WHEN MES = '07' THEN REAL END, 0)) AS "JUL_R",MAX(NVL(CASE WHEN MES = '07' THEN PERC END, 0)) AS "JUL_PERC",MAX(CASE WHEN MES = '08' THEN PREV END) AS "AGO_P",MAX(NVL(CASE WHEN MES = '08' THEN REAL END, 0)) AS "AGO_R",MAX(NVL(CASE WHEN MES = '08' THEN PERC END, 0)) AS "AGO_PERC",MAX(CASE WHEN MES = '09' THEN PREV END) AS "SET_P",MAX(NVL(CASE WHEN MES = '09' THEN REAL END, 0)) AS "SET_R",MAX(NVL(CASE WHEN MES = '09' THEN PERC END, 0)) AS "SET_PERC",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_P",MAX(NVL(CASE WHEN MES = '10' THEN REAL END, 0)) AS "OUT_R",MAX(NVL(CASE WHEN MES = '10' THEN PERC END, 0)) AS "OUT_PERC",MAX(CASE WHEN MES = '11' THEN PREV END) AS "NOV_P",MAX(NVL(CASE WHEN MES = '11' THEN REAL END, 0)) AS "NOV_R",MAX(NVL(CASE WHEN MES = '11' THEN PERC END, 0)) AS "NOV_PERC",MAX(CASE WHEN MES = '12' THEN PREV END) AS "DEZ_P",MAX(NVL(CASE WHEN MES = '12' THEN REAL END, 0)) AS "DEZ_R",MAX(NVL(CASE WHEN MES = '12' THEN PERC END, 0)) AS "DEZ_PERC"FROM(WITH B AS (SELECT LPAD(CODIGO, 10, '0') AS CODIGO1, DESCRICAO,GRAU FROM AD_ORCFIN)SELECTA.ANO,A.MES,A.MES_ANO,A.CODIGO1,CASEWHEN A.CODIGO1 LIKE '0499999999' THEN 'MARGEM DE CONTRIBUIÇÃO'WHEN A.CODIGO1 LIKE '0599999999' THEN 'LUCRO OPERACIONAL ANTES DOS INVESTIMENTOS'WHEN A.CODIGO1 LIKE '0699999998' THEN 'DESPESA OPERACIONAL TOTAL'WHEN A.CODIGO1 LIKE '0699999999' THEN 'LUCRO OPERACIONAL'WHEN A.CODIGO1 LIKE '0799999999' THEN 'RESULTADO LÍQUIDO'WHEN A.CODIGO1 LIKE '0899999998' THEN 'DISTRIBUIÇÃO PARA SÓCIOS'WHEN A.CODIGO1 LIKE '0899999999' THEN 'REINVESTIMENTO GRUPO SATIS'ELSE B.DESCRICAO END AS DESCRICAO, B.GRAU,A.PREV,A.REAL,(A.REAL / MAX(A.REAL) OVER (PARTITION BY A.MES))*100 AS PERCFROM(SELECTANO,MES,MES_ANO,GRAU,CODIGO1,SUM(PREV) AS PREV,SUM(REAL) AS REALFROM(WITH BAS AS(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'WHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANO,GRAU,CODIGO1/* TOTALIZADORES */UNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0499999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FININNER JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATINNER JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0599999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0799999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END)AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANO) ALEFT JOIN B ON A.CODIGO1 = B.CODIGO1GROUP BYA.ANO,A.MES,A.MES_ANO,A.CODIGO1,B.DESCRICAO,B.GRAU, A.PREV,A.REAL)GROUP BY CODIGO1,DESCRICAO,GRAU)ORDER BY CODIGO1]]></expression>
          <metadata>
            <field name="CODIGO1" label="Código" type="S" visible="true" useFooter="false"/>
            <field name="DESCRICAO" label="Descrição" type="S" visible="true" useFooter="false"/>
            <field name="GRAU" label="Grau" type="S" visible="true" useFooter="false"/>
            <field name="JAN_P" label="JAN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JAN_R" label="JAN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JAN_PERC" label="JAN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="FEV_P" label="FEV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="FEV_R" label="FEV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="FEV_PERC" label="FEV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="MAR_P" label="MAR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAR_R" label="MAR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAR_PERC" label="MAR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="ABR_P" label="ABR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="ABR_R" label="ABR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="ABR_PERC" label="ABR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="MAI_P" label="MAI. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAI_R" label="MAI. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAI_PERC" label="MAI. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="JUN_P" label="JUN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUN_R" label="JUN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUN_PERC" label="JUN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="JUL_P" label="JUL. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUL_R" label="JUL. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUL_PERC" label="JUL. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="AGO_P" label="AGO. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="AGO_R" label="AGO. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="AGO_PERC" label="AGO. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="SET_P" label="SET. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="SET_R" label="SET. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="SET_PERC" label="SET. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="OUT_P" label="OUT. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="OUT_R" label="OUT. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="OUT_PERC" label="OUT. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="NOV_P" label="NOV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="NOV_R" label="NOV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="NOV_PERC" label="NOV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="DEZ_P" label="DEZ. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="DEZ_R" label="DEZ. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="DEZ_PERC" label="DEZ. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="TTL_PREV" label="Total PREV." type="F" visible="true" useFooter="null" mask="#.##0,00">
              <formatter greaterEqualThan="0"><![CDATA[<span style="; background-color:#33FF00">
  <b>$VALUE</b>
</span>]]></formatter>
            </field>
            <field name="TTL_REAL" label="Total REAL" type="F" visible="true" useFooter="false" mask="#.##0,00">
              <formatter greaterEqualThan="0"><![CDATA[<span style="; background-color:#33FF00">
  <b>$VALUE</b>
</span>]]></formatter>
            </field>
            <field name="BKCOLOR" label="BKCOLOR" type="S" visible="true" useFooter="false"/>
            <field name="FGCOLOR" label="FGCOLOR" type="S" visible="true" useFooter="false"/>
          </metadata>
          <on-click navigate-to="lvl_asj889p">
            <param id="A_CODIGO">$CODIGO1</param>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="50">
        <grid id="grd_at0vuae" useNewGrid="S">
          <title><![CDATA[<b>Planejamento Orçamento - Periodo: :P_PERIODO2 </b>]]></title>
          <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODIGO1,DESCRICAO,GRAU,JAN_P,JAN_R,JAN_PERC,FEV_P,FEV_R,FEV_PERC,MAR_P,MAR_R,MAR_PERC,ABR_P,ABR_R,ABR_PERC,MAI_P,MAI_R,MAI_PERC,JUN_P,JUN_R,JUN_PERC,JUL_P,JUL_R,JUL_PERC,AGO_P,AGO_R,AGO_PERC,SET_P,SET_R,SET_PERC,OUT_P,OUT_R,OUT_PERC,NOV_P,NOV_R,NOV_PERC,DEZ_P,DEZ_R,DEZ_PERC,JAN_P + FEV_P + MAR_P + ABR_P + MAI_P + JUN_P + JUL_P + AGO_P + SET_P + OUT_P + NOV_P + DEZ_P AS TTL_PREV,JAN_R + FEV_R + MAR_R + ABR_R + MAI_R + JUN_R + JUL_R + AGO_R + SET_R + OUT_R + NOV_R + DEZ_R AS TTL_REAL,CASE WHEN GRAU = 1 THEN '#8EA9DB' WHEN GRAU = 2 THEN '#c6d4ed'WHEN GRAU = 3 THEN '#dde5f4'WHEN GRAU = 4 THEN '#e8f5cc'WHEN GRAU = 5 THEN '#f0eaf5'WHEN GRAU IS NULL THEN '#2e34db'END AS BKCOLOR,CASE WHEN GRAU IS NULL THEN '#fafafc'END AS FGCOLORFROM(SELECTCODIGO1,DESCRICAO,GRAU,MAX(CASE WHEN MES = '01' THEN PREV END) AS "JAN_P",MAX(NVL(CASE WHEN MES = '01' THEN REAL END, 0)) AS "JAN_R",MAX(NVL(CASE WHEN MES = '01' THEN PERC END, 0)) AS "JAN_PERC",MAX(CASE WHEN MES = '02' THEN PREV END) AS "FEV_P",MAX(NVL(CASE WHEN MES = '02' THEN REAL END, 0)) AS "FEV_R",MAX(NVL(CASE WHEN MES = '02' THEN PERC END, 0)) AS "FEV_PERC",MAX(CASE WHEN MES = '03' THEN PREV END) AS "MAR_P",MAX(NVL(CASE WHEN MES = '03' THEN REAL END, 0)) AS "MAR_R",MAX(NVL(CASE WHEN MES = '03' THEN PERC END, 0)) AS "MAR_PERC",MAX(CASE WHEN MES = '04' THEN PREV END) AS "ABR_P",MAX(NVL(CASE WHEN MES = '04' THEN REAL END, 0)) AS "ABR_R",MAX(NVL(CASE WHEN MES = '04' THEN PERC END, 0)) AS "ABR_PERC",MAX(CASE WHEN MES = '05' THEN PREV END) AS "MAI_P",MAX(NVL(CASE WHEN MES = '05' THEN REAL END, 0)) AS "MAI_R",MAX(NVL(CASE WHEN MES = '05' THEN PERC END, 0)) AS "MAI_PERC",MAX(CASE WHEN MES = '06' THEN PREV END) AS "JUN_P",MAX(NVL(CASE WHEN MES = '06' THEN REAL END, 0)) AS "JUN_R",MAX(NVL(CASE WHEN MES = '06' THEN PERC END, 0)) AS "JUN_PERC",MAX(CASE WHEN MES = '07' THEN PREV END) AS "JUL_P",MAX(NVL(CASE WHEN MES = '07' THEN REAL END, 0)) AS "JUL_R",MAX(NVL(CASE WHEN MES = '07' THEN PERC END, 0)) AS "JUL_PERC",MAX(CASE WHEN MES = '08' THEN PREV END) AS "AGO_P",MAX(NVL(CASE WHEN MES = '08' THEN REAL END, 0)) AS "AGO_R",MAX(NVL(CASE WHEN MES = '08' THEN PERC END, 0)) AS "AGO_PERC",MAX(CASE WHEN MES = '09' THEN PREV END) AS "SET_P",MAX(NVL(CASE WHEN MES = '09' THEN REAL END, 0)) AS "SET_R",MAX(NVL(CASE WHEN MES = '09' THEN PERC END, 0)) AS "SET_PERC",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_P",MAX(NVL(CASE WHEN MES = '10' THEN REAL END, 0)) AS "OUT_R",MAX(NVL(CASE WHEN MES = '10' THEN PERC END, 0)) AS "OUT_PERC",MAX(CASE WHEN MES = '11' THEN PREV END) AS "NOV_P",MAX(NVL(CASE WHEN MES = '11' THEN REAL END, 0)) AS "NOV_R",MAX(NVL(CASE WHEN MES = '11' THEN PERC END, 0)) AS "NOV_PERC",MAX(CASE WHEN MES = '12' THEN PREV END) AS "DEZ_P",MAX(NVL(CASE WHEN MES = '12' THEN REAL END, 0)) AS "DEZ_R",MAX(NVL(CASE WHEN MES = '12' THEN PERC END, 0)) AS "DEZ_PERC"FROM(WITH B AS (SELECT LPAD(CODIGO, 10, '0') AS CODIGO1, DESCRICAO,GRAU FROM AD_ORCFIN)SELECTA.ANO,A.MES,A.MES_ANO,A.CODIGO1,CASEWHEN A.CODIGO1 LIKE '0499999999' THEN 'MARGEM DE CONTRIBUIÇÃO'WHEN A.CODIGO1 LIKE '0599999999' THEN 'LUCRO OPERACIONAL ANTES DOS INVESTIMENTOS'WHEN A.CODIGO1 LIKE '0699999998' THEN 'DESPESA OPERACIONAL TOTAL'WHEN A.CODIGO1 LIKE '0699999999' THEN 'LUCRO OPERACIONAL'WHEN A.CODIGO1 LIKE '0799999999' THEN 'RESULTADO LÍQUIDO'WHEN A.CODIGO1 LIKE '0899999998' THEN 'DISTRIBUIÇÃO PARA SÓCIOS'WHEN A.CODIGO1 LIKE '0899999999' THEN 'REINVESTIMENTO GRUPO SATIS'ELSE B.DESCRICAO END AS DESCRICAO, B.GRAU,A.PREV,A.REAL,(A.REAL / MAX(A.REAL) OVER (PARTITION BY A.MES))*100 AS PERCFROM(SELECTANO,MES,MES_ANO,GRAU,CODIGO1,SUM(PREV) AS PREV,SUM(REAL) AS REALFROM(WITH BAS AS(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'WHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANO,GRAU,CODIGO1/* TOTALIZADORES */UNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0499999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FININNER JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATINNER JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0599999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0799999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END)AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,ABS(SUM(NVL(PREVREC - PREVDESP,0))) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODO2GROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(NVL(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END,0)) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODO2AND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND (ORC.GRUPOPROD = PRO.CODGRUPOPROD OR ORC.GRUPOPROD IS NULL)AND (ORC.GRUPOPRODDIF <> PRO.CODGRUPOPROD OR ORC.GRUPOPRODDIF IS NULL)GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,ABS(SUM(NVL(FIN.VLRBAIXA,0))) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODO2AND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)WHERE CODIGO1 IS NOT NULL AND CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BY ANO,MES,MES_ANO) ALEFT JOIN B ON A.CODIGO1 = B.CODIGO1GROUP BYA.ANO,A.MES,A.MES_ANO,A.CODIGO1,B.DESCRICAO,B.GRAU, A.PREV,A.REAL)GROUP BY CODIGO1,DESCRICAO,GRAU)ORDER BY CODIGO1]]></expression>
          <metadata>
            <field name="CODIGO1" label="Código" type="S" visible="true" useFooter="false"/>
            <field name="DESCRICAO" label="Descrição" type="S" visible="true" useFooter="false"/>
            <field name="GRAU" label="Grau" type="S" visible="true" useFooter="false"/>
            <field name="JAN_P" label="JAN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JAN_R" label="JAN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JAN_PERC" label="JAN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="FEV_P" label="FEV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="FEV_R" label="FEV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="FEV_PERC" label="FEV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="MAR_P" label="MAR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAR_R" label="MAR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAR_PERC" label="MAR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="ABR_P" label="ABR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="ABR_R" label="ABR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="ABR_PERC" label="ABR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="MAI_P" label="MAI. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAI_R" label="MAI. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="MAI_PERC" label="MAI. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="JUN_P" label="JUN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUN_R" label="JUN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUN_PERC" label="JUN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="JUL_P" label="JUL. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUL_R" label="JUL. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="JUL_PERC" label="JUL. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="AGO_P" label="AGO. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="AGO_R" label="AGO. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="AGO_PERC" label="AGO. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="SET_P" label="SET. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="SET_R" label="SET. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="SET_PERC" label="SET. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="OUT_P" label="OUT. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="OUT_R" label="OUT. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="OUT_PERC" label="OUT. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="NOV_P" label="NOV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="NOV_R" label="NOV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="NOV_PERC" label="NOV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="DEZ_P" label="DEZ. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="DEZ_R" label="DEZ. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            <field name="DEZ_PERC" label="DEZ. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
            <field name="TTL_PREV" label="Total PREV." type="F" visible="true" useFooter="null" mask="#.##0,00">
              <formatter greaterEqualThan="0"><![CDATA[<span style="; background-color:#33FF00">
  <b>$VALUE</b>
</span>]]></formatter>
            </field>
            <field name="TTL_REAL" label="Total REAL" type="F" visible="true" useFooter="false" mask="#.##0,00">
              <formatter greaterEqualThan="0"><![CDATA[<span style="; background-color:#33FF00">
  <b>$VALUE</b>
</span>]]></formatter>
            </field>
            <field name="BKCOLOR" label="BKCOLOR" type="S" visible="true" useFooter="false"/>
            <field name="FGCOLOR" label="FGCOLOR" type="S" visible="true" useFooter="false"/>
          </metadata>
          <on-click navigate-to="lvl_asj889p">
            <param id="A_CODIGO">$CODIGO1</param>
          </on-click>
        </grid>
      </container>
    </container>
  </level>
</gadget>