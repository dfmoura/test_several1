<gadget >
  <prompt-parameters>
    <parameter  id="P_PERIODO" description="Periodo" metadata="datePeriod" required="true" keep-last="true" keep-date="false" order="0" label="P_PERIODO : Período"/>
    <parameter  id="P_CODMETA" description="Cód. Meta" metadata="entity:ConfiguracaoMeta@CODMETA" required="true" keep-last="true" keep-date="false" order="2" label="P_CODMETA : Entidade/Tabela"/>
    <parameter  id="P_CODVEND" description="Cód.Vend." metadata="multiList:Text" listType="sql" required="false" keep-last="true" keep-date="false" order="3" label="P_CODVEND : multiList:Text">
      <expression type="SQL">
        <![CDATA[SELECT
MET.CODVEND AS VALUE
, MET.CODVEND  ||' - '|| VEN.APELIDO AS LABEL
FROM TGMMET MET
LEFT JOIN TGFVEN VEN ON MET.CODVEND = VEN.CODVEND
GROUP BY
MET.CODVEND
, VEN.APELIDO
ORDER BY VEN.APELIDO]]>
      </expression>
    </parameter>
    <parameter  id="P_CODPARC" description="Cliente" metadata="entity:Parceiro@CODPARC" required="false" keep-last="true" keep-date="false" order="4" label="P_CODPARC : Entidade/Tabela"/>
    <parameter  id="P_MARCA" description="Marca" metadata="multiList:Text" listType="sql" required="false" keep-last="true" keep-date="false" order="5" label="P_MARCA : multiList:Text">
      <expression type="SQL">
        <![CDATA[select
SEQ AS VALUE
,SEQ ||' - ' ||MARCA AS LABEL
from AD_VGFMARCA
order by MARCA]]>
      </expression>
    </parameter>
    <parameter  id="P_NTEMMETA" description="Ignorar Ref. Sem Meta Prev./Real" metadata="boolean" required="false" keep-last="true" keep-date="false" default="false" order="6" label="P_NTEMMETA : Verdadeiro/Falso"/>
    <parameter  id="P_GRUPOPROD" description="Grupo de Produtos" metadata="entity:GrupoProduto@CODGRUPOPROD" required="false" keep-last="true" keep-date="false" order="7" label="P_GRUPOPROD : Entidade/Tabela"/>
    <parameter  id="P_CR" description="CR" metadata="entity:CentroResultado@CODCENCUS" required="false" keep-last="true" keep-date="false" order="9" label="P_CR : Entidade/Tabela"/>
    <parameter  id="P_CODGER" description="Coordenador / Supervisor" metadata="multiList:Text" listType="sql" required="false" keep-last="true" keep-date="false" order="10" label="P_CODGER : multiList:Text">
      <expression type="SQL">
        <![CDATA[select
ven.codger as value
, ven.codger||' - '||ven1.apelido as label
from tgfven ven
inner join tgfven ven1 on ven.codger = ven1.codvend
group by 
ven.codger
, ven1.apelido
order by ven1.apelido]]>
      </expression>
    </parameter>
  </prompt-parameters>
  <level id="lvl_c3rh8k" description="Principal">
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="H" tamanhoRelativo="337">
        <container orientacao="V" tamanhoRelativo="1162">
          <simple-value id="svl_eadypt">
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT		SUM(QTDPREV) AS QTDPREV		, SUM(QTDREAL) AS QTDREAL		, SUM(QTDPREV * PRECOLT)  AS VLR_PREV		, SUM(NVL(VLRREAL, 0)) AS VLR_REAL          , CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC          , CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLR		FROM		(		SELECT        MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA        , MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL		FROM TGMMET MET        LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)        LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)        LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')        LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0        LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA        LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD		WHERE		MET.CODMETA = :P_CODMETA		  AND MET.DTREF >= :P_PERIODO.INI          AND MET.DTREF <= :P_PERIODO.FIN          AND MET.CODVEND IN :P_CODVEND         AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))      AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')          AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)          AND (VEN.CODGER IN :P_CODGER)/*          AND CAB.CODEMP IN :P_EMPRESA*/       AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)		GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF		)]]>
            </expression>
            <metadata>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC" label="PERC" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC_VLR" label="PERC_VLR" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            </metadata>
            <value-expression>
              <![CDATA[<center><table cellspacing="0"><tr><td height = 20 bgcolor = "#FFFFFF " colspan="7" ><span style='color: #000000 ; font-size: 18px;'><center><B>&nbspANALISE DA META&nbsp<br><span style='font-size: 14px;'>Período: :P_PERIODO.INI a :P_PERIODO.FIN</span></b></center></span></td></tr><tr bgcolor = "#E8F5E9"><td height = 20 bgcolor = "#FFFFFF " ><span style='color: #FFFFFF ;'><center>&nbsp&nbsp</center></span></td><td height = 20 bgcolor = "#4CAF50 " width = 180><span style='color: #FFFFFF ;'><center><b>&nbspQtd. Prev.&nbsp</b></center></span></td><td height = 20 bgcolor = "#FF9800 " width = 180><span style='color: #FFFFFF ;'><center><b>&nbspQtd. Real&nbsp</b></center></span></td><td height = 20 bgcolor = "#F44336 " width = 180><span style='color: #FFFFFF ;'><center><b>&nbsp%&nbsp</b></center></span></td><td height = 20 bgcolor = "#4CAF50 " width = 180><span style='color: #FFFFFF ;'><center><b>&nbspVlr. Prev.&nbsp</b></center></span></td><td height = 20 bgcolor = "#FF9800 " width = 180><span style='color: #FFFFFF ;'><center><b>&nbspVlr. Real&nbsp</b></center></span></td><td height = 20 bgcolor = "#F44336 " width = 180><span style='color: #FFFFFF ;'><center><b>&nbsp%&nbsp</b></center></span></td></tr><tr bgcolor = "#E8F5E9"><td height = 20 bgcolor = "#FFFFFF "><b>&nbspTotais&nbsp</b></td><td height = 20 bgcolor = "#E8F5E9 "><div style='text-align: right;'><center><b>&nbsp$QTDPREV&nbsp</b></center></div></td><td height = 20 bgcolor = "#FFF3E0 "><div style='text-align: right;'><center><b>&nbsp$QTDREAL&nbsp</b></center></div></td><td height = 20 bgcolor = "#FFEBEE "><div style='text-align: right;'><center><b>&nbsp$PERC&nbsp</b></center></div></td><td height = 20 bgcolor = "#E8F5E9 "><div style='text-align: right;'><center><b>&nbsp$VLR_PREV&nbsp</b></center></div></td><td height = 20 bgcolor = "#FFF3E0 "><div style='text-align: right;'><center><b>&nbsp$VLR_REAL&nbsp</b></center></div></td><td height = 20 bgcolor = "#FFEBEE "><div style='text-align: right;'><center><b>&nbsp$PERC_VLR&nbsp</b></center></div></td></table></center>]]>
            </value-expression>
          </simple-value>
        </container>
        <container orientacao="V" tamanhoRelativo="100">
          <simple-value id="svl_rlk0e7">
            <value-expression>
              <![CDATA[<div style='text-align: center;'><div style='text-align: center;'><b>Comparativo<br>Comercial</b></div><img src='https://e7.pngegg.com/pngimages/595/756/png-clipart-computer-icons-compare-icon-blue-angle-thumbnail.png' alt='Comparison Icon' style='width: 50px; height: 50px;'></div>]]>
            </value-expression>
            <on-click-launcher  resource-id="br.com.sankhya.menu.adicional.nuDsb.167.1"/>
          </simple-value>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="355">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_dvthgf" type="gauge">
            <title>
              <![CDATA[<b>Percentual de Atingimento da Meta de VOLUME</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC_ATINGIDO		FROM		(		SELECT		MET.DTREF		, MET.CODVEND		, VEN.APELIDO		, MET.CODPARC		, PAR.RAZAOSOCIAL		, PAR.CGC_CPF		, MET.MARCA		, MET.QTDPREV		, MET.QTDREAL		, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL		FROM TGMMET MET		LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)		LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)		LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')		LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0		LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA		LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD		LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA		LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA		LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRU		WHERE		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN        AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))          AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')          AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)          AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)          /*AND CAB.CODEMP IN :P_EMPRESA*/          AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)		GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF		)		WHERE (QTDPREV <> 0 OR QTDREAL <> 0)]]>
            </expression>
            <metadata>
              <field name="PERC_ATINGIDO" label="% Atingido" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <show-ticks>true</show-ticks>
            <min-value>0</min-value>
            <max-value>100</max-value>
            <value-field>PERC_ATINGIDO</value-field>
            <alert-colors values="0,30,50,70,90,100" colors="0xFF0000,0xFF9900,0x00FFFF,0x0000FF,0x00FF00"></alert-colors>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_dvthg2" type="gauge">
            <title>
              <![CDATA[<b>Percentual de Atingimento da Meta de VALOR</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT          CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_ATINGIDO		FROM		(		SELECT		MET.DTREF		, MET.CODVEND		, VEN.APELIDO		, MET.CODPARC		, PAR.RAZAOSOCIAL		, PAR.CGC_CPF		, MET.MARCA		, MET.QTDPREV		, MET.QTDREAL		, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL		FROM TGMMET MET		LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)		LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)		LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')		LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0		LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA		LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD		LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA		LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA		LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRU		WHERE		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN        AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)		GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF		)		WHERE (QTDPREV <> 0 OR QTDREAL <> 0)]]>
            </expression>
            <metadata>
              <field name="PERC_ATINGIDO" label="% Atingido" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <show-ticks>true</show-ticks>
            <min-value>0</min-value>
            <max-value>100</max-value>
            <value-field>PERC_ATINGIDO</value-field>
            <alert-colors values="0,30,50,70,90,100" colors="0xFF0000,0xFF9900,0x00FFFF,0x0000FF,0x00FF00"></alert-colors>
          </chart>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="508">
        <container orientacao="H" tamanhoRelativo="100">
          <container orientacao="V" tamanhoRelativo="50">
            <chart id="cht_f1xjzp" type="column" nroColuna="10">
              <title>
                <![CDATA[<b>TOP 10 Vendedores - Volume</b>]]>
              </title>
              <expression type="sql" data-source="MGEDS">
                <![CDATA[SELECTCODVEND, APELIDO, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS APELIDO_PERC, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS APELIDO_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND(CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA VENDEDOR*/OR CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BYCODVEND, APELIDOORDER BY "QTDREAL" DESCFETCH FIRST 10 ROWS ONLY]]>
              </expression>
              <metadata>
                <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
                <field name="APELIDO" label="Vededor" type="S" visible="true" useFooter="false"></field>
                <field name="APELIDO_PERC" label="Vendedor e % Atingido Meta Qtd." type="S" visible="true" useFooter="false"></field>
                <field name="APELIDO_PERC_VLR" label="Vendedor e % Atingido Meta Vlr." type="S" visible="true" useFooter="false"></field>
                <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="false"></field>
                <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
                <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
                <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
                <field name="PERC" label="% Volume" type="F" visible="true" useFooter="false"></field>
                <field name="PERC_VLR" label="PERC_VLR" type="F" visible="true" useFooter="false"></field>
              </metadata>
              <horizontal-axis>
                <category field="undefined" rotation="-90" dropLabel="false">
                  <initView value="first"></initView>
                </category>
              </horizontal-axis>
              <series>
                <serie type="column">
                  <xField>APELIDO_PERC</xField>
                  <yField>QTDREAL</yField>
                  <color>0xff9800</color>
                </serie>
                <serie type="column">
                  <xField>APELIDO_PERC</xField>
                  <yField>QTDPREV</yField>
                  <color>0x4caf50</color>
                </serie>
              </series>
            </chart>
          </container>
          <container orientacao="V" tamanhoRelativo="50">
            <chart id="cht_f1xjzr" type="column" nroColuna="10">
              <title>
                <![CDATA[<b>TOP 10 Vendedores - Valores</b>]]>
              </title>
              <expression type="sql" data-source="MGEDS">
                <![CDATA[SELECTCODVEND, APELIDO, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS APELIDO_PERC, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS APELIDO_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYCODVEND, APELIDOORDER BY "VLR_REAL" DESCFETCH FIRST 10 ROWS ONLY]]>
              </expression>
              <metadata>
                <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
                <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
                <field name="APELIDO_PERC" label="Vendedor e % Atingido Meta Qtd." type="S" visible="true" useFooter="false"></field>
                <field name="APELIDO_PERC_VLR" label="Vendedor e % Atingido Meta Vlr." type="S" visible="true" useFooter="false"></field>
                <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
                <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
                <field name="VLR_PREV" label="Vlr. Prev." type="F" visible="true" useFooter="false"></field>
                <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false"></field>
                <field name="PERC" label="% Valor" type="F" visible="true" useFooter="false"></field>
                <field name="PERC_VLR" label="PERC_VLR" type="F" visible="true" useFooter="false"></field>
              </metadata>
              <horizontal-axis>
                <category field="undefined" rotation="-90" dropLabel="false">
                  <initView value="first"></initView>
                </category>
              </horizontal-axis>
              <series>
                <serie type="column">
                  <xField>APELIDO_PERC_VLR</xField>
                  <yField>VLR_PREV</yField>
                  <color>0x4caf50</color>
                </serie>
                <serie type="column">
                  <xField>APELIDO_PERC_VLR</xField>
                  <yField>VLR_REAL</yField>
                  <color>0xff9800</color>
                </serie>
              </series>
            </chart>
          </container>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="126">
        <container orientacao="H" tamanhoRelativo="33">
          <simple-value id="svl_f1xj1w">
            <value-expression>
              <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px;'>Análise Vendedor</button></div>]]>
            </value-expression>
            <on-click  navigate-to="lvl_g2sil3"/>
          </simple-value>
        </container>
        <container orientacao="H" tamanhoRelativo="33">
          <simple-value id="svl_g2sils">
            <value-expression>
              <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px;'>Análise Cliente</button></div>]]>
            </value-expression>
            <on-click  navigate-to="lvl_f1xj5j"/>
          </simple-value>
        </container>
        <container orientacao="H" tamanhoRelativo="33">
          <simple-value id="svl_g8hnqe">
            <value-expression>
              <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px;'>Análise Marca</button></div>]]>
            </value-expression>
            <on-click  navigate-to="lvl_g8hnbl"/>
          </simple-value>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g2sil3" description="Nivel1">
    <args >
      <arg id="A_CODVEND" type="integer"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="141">
        <grid id="grd_htp5r4" useNewGrid="S">
          <title>
            <![CDATA[<b>Consolidado por Vendedor</b>]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CODVEND, APELIDO, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL) AS VLRREAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0))WHERE(QTDPREV <> 0 OR QTDREAL <> 0) GROUP BY CODVEND, APELIDOORDER BY 5 DESC]]>
          </expression>
          <metadata>
            <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd. Prev." type="I" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd. Real" type="I" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="VLRREAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hnu8">
            <param id="A_CODVEND">$CODVEND</param>
            <param id="A_APELIDO">$APELIDO</param>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hni1" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 Vendedores - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCODVEND, APELIDO, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS APELIDO_PERC, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS APELIDO_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYCODVEND, APELIDOORDER BY 6 DESCFETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="APELIDO_PERC" label="Vendedor e % Atingido Meta Qtd." type="S" visible="true" useFooter="false"></field>
              <field name="APELIDO_PERC_VLR" label="APELIDO_PERC_VLR" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false"></field>
            </metadata>
            <horizontal-axis>
              <category field="undefined" rotation="-90" dropLabel="false">
                <initView value="first"></initView>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>APELIDO_PERC</xField>
                <yField>QTDPREV</yField>
                <color>0x4caf50</color>
              </serie>
              <serie type="column">
                <xField>APELIDO_PERC</xField>
                <yField>QTDREAL</yField>
                <color>0xff9800</color>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hni3" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 Vendedores - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCODVEND, APELIDO, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS APELIDO_PERC, SUBSTR(APELIDO,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS APELIDO_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYCODVEND, APELIDOORDER BY 8 DESCFETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="APELIDO_PERC" label="APELIDO_PERC" type="S" visible="true" useFooter="false"></field>
              <field name="APELIDO_PERC_VLR" label="Vendedor e % Atingido Meta Vlr." type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="Vlr. Prev." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC" label="PERC" type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="% Valor" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <horizontal-axis>
              <category field="undefined" rotation="-90" dropLabel="false">
                <initView value="first"></initView>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>APELIDO_PERC_VLR</xField>
                <yField>VLR_PREV</yField>
                <color>0x4caf50</color>
              </serie>
              <serie type="column">
                <xField>APELIDO_PERC_VLR</xField>
                <yField>VLR_REAL</yField>
                <color>0xff9800</color>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_f1xj5j" description="Nivel2">
    <args >
      <arg id="A_CODVEND" type="integer"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="146">
        <grid id="grd_g8hnak" multiplaSelecao="N" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Consolidado por Cliente]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CODPARC, RAZAOSOCIAL, CGC_CPF, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL,PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0     LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF) WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY CODPARC, RAZAOSOCIAL,CGC_CPFORDER BY 6 DESC]]>
          </expression>
          <metadata>
            <field name="CODPARC" label="Cód.Parc." type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
            <field name="CGC_CPF" label="Cnpj / Cpf" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hn8s">
            <param id="A_CODPARC">$CODPARC</param>
            <param id="A_CLIENTE">$RAZAOSOCIAL</param>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hnjk" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCODPARC, RAZAOSOCIAL, SUBSTR(RAZAOSOCIAL,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS RAZAO_PERC, SUBSTR(RAZAOSOCIAL,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS RAZAO_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYCODPARC, RAZAOSOCIALORDER BY 6 DESCFETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="RAZAO_PERC" label="Cliente e % Atingido Meta Qtd." type="S" visible="true" useFooter="false"></field>
              <field name="RAZAO_PERC_VLR" label="RAZAO_PERC_VLR" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="PERC" label="% Volume" type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="PERC_VLR" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <horizontal-axis>
              <category field="undefined" rotation="-90" dropLabel="false">
                <initView value="first"></initView>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>RAZAO_PERC</xField>
                <yField>QTDPREV</yField>
                <color>0x4caf50</color>
              </serie>
              <serie type="column">
                <xField>RAZAO_PERC</xField>
                <yField>QTDREAL</yField>
                <color>0xff9800</color>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hnjm" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCODPARC, RAZAOSOCIAL, SUBSTR(RAZAOSOCIAL,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS RAZAO_PERC, SUBSTR(RAZAOSOCIAL,1,15) ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS RAZAO_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYCODPARC, RAZAOSOCIALORDER BY 8 DESCFETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="RAZAO_PERC" label="Cliente e % Atingido Meta Qtd." type="S" visible="true" useFooter="false"></field>
              <field name="RAZAO_PERC_VLR" label="RAZAO_PERC_VLR" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="Vlr. Prev." type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC" label="PERC" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC_VLR" label="% Valor" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <horizontal-axis>
              <category field="undefined" rotation="-90" dropLabel="false">
                <initView value="first"></initView>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>RAZAO_PERC_VLR</xField>
                <yField>VLR_PREV</yField>
                <color>0x4caf50</color>
              </serie>
              <serie type="column">
                <xField>RAZAO_PERC_VLR</xField>
                <yField>VLR_REAL</yField>
                <color>0xff9800</color>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hnbl" description="Nivel3">
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="187">
        <grid id="grd_g8hncu" useNewGrid="S">
          <title>
            <![CDATA[Consolidado por Marca]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)  GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0)) WHERE(QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY MARCAORDER BY 4 DESC]]>
          </expression>
          <metadata>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hn8u">
            <param id="A_MARCA">$MARCA</param>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="109">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hnj5" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 Marcas - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTMARCA, MARCA ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS MARCA_PERC, MARCA ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS MARCA_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYMARCAORDER BY 5 DESCFETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA_PERC" label="Marca e % Atingido Meta Qtd." type="S" visible="true" useFooter="false"></field>
              <field name="MARCA_PERC_VLR" label="MARCA_PERC_VLR" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="PERC" label="% Volume" type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="PERC_VLR" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <horizontal-axis>
              <category field="undefined" rotation="-90" dropLabel="false">
                <initView value="first"></initView>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>MARCA_PERC</xField>
                <yField>QTDPREV</yField>
                <color>0x4caf50</color>
              </serie>
              <serie type="column">
                <xField>MARCA_PERC</xField>
                <yField>QTDREAL</yField>
                <color>0xff9800</color>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hnj7" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 Marcas - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTMARCA, MARCA ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END,'9,999.99')||'%' AS MARCA_PERC, MARCA ||' - '|| TO_CHAR(CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END,'9,999.99')||'%' AS MARCA_PERC_VLR, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYMARCAORDER BY 7 DESCFETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="MARCA" label="MARCA" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA_PERC" label="MARCA_PERC" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA_PERC_VLR" label="Marca e % Atingido Meta Vlr." type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="Vlr. Prev" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
              <field name="PERC" label="PERC" type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="% Valor" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <horizontal-axis>
              <category field="undefined" rotation="-90" dropLabel="false">
                <initView value="first"></initView>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>MARCA_PERC_VLR</xField>
                <yField>VLR_PREV</yField>
                <color>0x4caf50</color>
              </serie>
              <serie type="column">
                <xField>MARCA_PERC_VLR</xField>
                <yField>VLR_REAL</yField>
                <color>0xff9800</color>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hnu8" description="Nivel1_A">
    <args >
      <arg id="A_CODVEND" type="integer"/>
      <arg id="A_APELIDO" type="text"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="168">
        <container orientacao="V" tamanhoRelativo="100">
          <grid id="grd_g8hnva" useNewGrid="S">
            <args>
              <arg id="A_DTREF" type="date"></arg>
              <arg id="A_CODVEND" type="integer"></arg>
            </args>
            <title>
              <![CDATA[<b> :A_APELIDO - Meta por Vendedor << Cliente</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT DTREF, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN       		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)  GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0)) WHERE CODVEND = :A_CODVEND GROUP BY DTREF, CODVEND, APELIDO, CODPARC, RAZAOSOCIALORDER BY 8 DESC]]>
            </expression>
            <metadata>
              <field name="DTREF" label="Mês" type="D" visible="false" useFooter="false"></field>
              <field name="CODVEND" label="Cód.Vend." type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="CODPARC" label="Cód.Parc." type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
              <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
              <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
                </formatter>
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
                </formatter>
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
                </formatter>
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
                </formatter>
              </field>
              <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
              <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
              <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
                </formatter>
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
                </formatter>
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
                </formatter>
                <formatter formula="true">
                  <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
                </formatter>
              </field>
            </metadata>
            <on-click  navigate-to="lvl_g8hn41">
              <param id="A_CODVEND">$CODVEND</param>
              <param id="A_CODPARC">$CODPARC</param>
              <param id="A_APELIDO">$APELIDO</param>
            </on-click>
          </grid>
        </container>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="H" tamanhoRelativo="117">
          <container orientacao="V" tamanhoRelativo="50">
            <simple-value id="svl_mrdy5u">
              <value-expression>
                <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px; background-color: green; color: white;'>Consolidado Vendedor</button></div>]]>
              </value-expression>
              <on-click  navigate-to="lvl_g8hoge">
                <param id="A_CODVEND">:A_CODVEND</param>
              </on-click>
            </simple-value>
          </container>
          <container orientacao="V" tamanhoRelativo="50">
            <simple-value id="svl_mrdy5w">
              <value-expression>
                <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px; background-color: green; color: white;'>Auditoria Valores</button></div>]]>
              </value-expression>
              <on-click  navigate-to="lvl_g8hogf">
                <param id="A_CODVEND">:A_CODVEND</param>
              </on-click>
            </simple-value>
          </container>
        </container>
        <container orientacao="H" tamanhoRelativo="462">
          <chart id="cht_mrdy5s" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODVEND = :A_CODVEND GROUP BYCODPARC, RAZAOSOCIAL)WHERE RN <= 3UNION ALLSELECT9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODVEND = :A_CODVEND GROUP BYCODPARC, RAZAOSOCIAL)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>QTDREAL</field>
                <nameField>RAZAOSOCIAL</nameField>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="H" tamanhoRelativo="508">
          <chart id="cht_mrdy5q" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODVEND = :A_CODVEND GROUP BYCODPARC, RAZAOSOCIAL)WHERE RN <= 3UNION ALLSELECT9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  AND (MARCAB.CODGRU = :P_GRUPOMARCA OR :P_GRUPOMARCA IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODVEND = :A_CODVEND GROUP BYCODPARC, RAZAOSOCIAL)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>VLR_REAL</field>
                <nameField>$RAZAOSOCIAL</nameField>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hn41" description="Nivel1_B">
    <args >
      <arg id="A_CODVEND" type="integer"/>
      <arg id="A_CODPARC" type="integer"/>
      <arg id="A_APELIDO" type="text"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="156">
        <grid id="grd_g8hn43" useNewGrid="S">
          <args>
            <arg id="A_CODPARC" type="integer"></arg>
            <arg id="A_DTREF" type="date"></arg>
          </args>
          <title>
            <![CDATA[<b>:A_APELIDO - Meta por Vendedor << Cliente << Marca</b>]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT DTREF, CODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)  GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0)) WHERE CODVEND = :A_CODVEND AND (CODPARC = :A_CODPARC)AND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY DTREF, CODPARC, RAZAOSOCIAL, MARCAORDER BY 7 DESC]]>
          </expression>
          <metadata>
            <field name="DTREF" label="Mês" type="D" visible="false" useFooter="false"></field>
            <field name="CODPARC" label="Cód.Parc." type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hn72" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTMARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE CODVEND = :A_CODVEND AND (CODPARC = :A_CODPARC)AND (QTDPREV <> 0 OR QTDREAL <> 0) GROUP BYMARCA)WHERE RN <= 3UNION ALLSELECT'OUTROS' AS MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTMARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERECODVEND = :A_CODVEND AND (CODPARC = :A_CODPARC)AND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYMARCA)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>QTDREAL</field>
                <nameField>MARCA</nameField>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_g8hn74" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Valores </b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTMARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERE CODVEND = :A_CODVEND AND (CODPARC = :A_CODPARC)AND (QTDPREV <> 0 OR QTDREAL <> 0) GROUP BYMARCA)WHERE RN <= 3UNION ALLSELECT'OUTROS' AS MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTMARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(NVL(VLRREAL, 0)) AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECTMET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, PAR.CGC_CPF, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT,  SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')  LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0  LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  LEFT JOIN AD_VGFMARCA VGMAR ON PRO.MARCA = VGMAR.MARCA  LEFT JOIN AD_GRUMARCAITE MARITE ON VGMAR.SEQ = MARITE.CODMARCA  LEFT JOIN AD_GRUMARCACAB MARCAB ON MARITE.CODGRU = MARCAB.CODGRUWHERE  MET.CODMETA = :P_CODMETA  AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN  AND MET.CODVEND IN :P_CODVEND  AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)  AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))  AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')  AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)  /*AND CAB.CODEMP IN :P_EMPRESA*/  AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL,  NVL(PRC.VLRVENDALT,0),PAR.CGC_CPF)WHERECODVEND = :A_CODVEND AND (CODPARC = :A_CODPARC)AND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYMARCA)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>VLR_REAL</field>
                <nameField>MARCA</nameField>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hn8s" description="Nivel2_A">
    <args >
      <arg id="A_CODPARC" type="integer"/>
      <arg id="A_CLIENTE" type="text"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="170">
        <grid id="grd_g8ho4t" useNewGrid="S">
          <args>
            <arg id="A_DTREF" type="date"></arg>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[<b>:A_CLIENTE - Meta por Cliente >> Marca</b>]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECTCODPARC, RAZAOSOCIAL, CODVEND, APELIDO, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODPARC = :A_CODPARCGROUP BY CODPARC, RAZAOSOCIAL, CODVEND, APELIDO, MARCAORDER BY 8]]>
          </expression>
          <metadata>
            <field name="CODPARC" label="Cód.Parc." type="I" visible="false" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="false" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false" mask="#.##0,00">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false" mask="#.##0,00">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hn8s">
            <param id="A_CODPARC"/>
            <param id="A_CLIENTE"/>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="H" tamanhoRelativo="171">
          <container orientacao="V" tamanhoRelativo="50">
            <simple-value id="svl_mrdy34">
              <value-expression>
                <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px; background-color: green; color: white;'>Consolidado Cliente</button></div>]]>
              </value-expression>
              <on-click  navigate-to="lvl_hn5ox1">
                <param id="A_CODPARC">:A_CODPARC</param>
              </on-click>
            </simple-value>
          </container>
          <container orientacao="V" tamanhoRelativo="50">
            <simple-value id="svl_mrdy36">
              <value-expression>
                <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px; background-color: green; color: white;'>Auditoria Valores</button></div>]]>
              </value-expression>
              <on-click  navigate-to="lvl_hn5o1d">
                <param id="A_CODPARC">:A_CODPARC</param>
              </on-click>
            </simple-value>
          </container>
        </container>
        <container orientacao="H" tamanhoRelativo="531">
          <chart id="cht_mrdy32" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODPARC = :A_CODPARCGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN <= 3UNION ALLSELECT9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, 'OUTROS' AS MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODPARC = :A_CODPARCGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>QTDREAL</field>
                <nameField>MARCA</nameField>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="H" tamanhoRelativo="586">
          <chart id="cht_mrdy30" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODPARC = :A_CODPARCGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN <= 3UNION ALLSELECT9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, 'OUTROS' AS MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND CODPARC = :A_CODPARCGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza">
                <field>VLR_REAL</field>
                <nameField>MARCA</nameField>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hn8t" description="Nivel2_B">
    <args >
      <arg id="A_MARCA" type="text"/>
      <arg id="A_CODPARC" type="integer"/>
      <arg id="A_CODVEND" type="integer"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="50">
        <grid id="grd_iyh30e" useNewGrid="S">
          <args>
            <arg id="A_DTREF" type="date"></arg>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[<b>Meta por Cliente >> Marca >> Vendedor</b>]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECTCODPARC, RAZAOSOCIAL, MARCA, CODVEND, APELIDO, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)/*AND CODVEND = :A_CODVEND*/AND CODPARC = :A_CODPARCAND MARCA = :A_MARCAGROUP BY CODPARC, RAZAOSOCIAL, MARCA, CODVEND, APELIDOORDER BY 8]]>
          </expression>
          <metadata>
            <field name="CODPARC" label="Cód.Parc." type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
            <field name="MARCA" label="MARCA" type="S" visible="true" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hn8t">
            <param id="A_MARCA"/>
            <param id="A_CODPARC"/>
            <param id="A_CODVEND"/>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="50">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_iyh36p" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 Cliente >> Marca >> Vendedor - Volume</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCODPARC, RAZAOSOCIAL, MARCA, CODVEND, APELIDO, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)/*AND CODVEND = :A_CODVEND*/AND CODPARC = :A_CODPARCAND MARCA = :A_MARCAGROUP BY CODPARC, RAZAOSOCIAL, MARCA, CODVEND, APELIDOORDER BY 8FETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA" label="MARCA" type="S" visible="true" useFooter="false"></field>
              <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="PERC" label="% Volume" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="PERC_VLR" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="column" show-tip="false">
                <xField>APELIDO</xField>
                <yField>PERC</yField>
                <display>
                  <![CDATA[Vendedor]]>
                </display>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_iyh36r" type="column" nroColuna="10">
            <title>
              <![CDATA[<b>TOP 10 Cliente >> Vendedor >> Marca - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECTCODPARC, RAZAOSOCIAL, MARCA, CODVEND, APELIDO, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)/*AND CODVEND = :A_CODVEND*/AND CODPARC = :A_CODPARCAND MARCA = :A_MARCAGROUP BY CODPARC, RAZAOSOCIAL, MARCA, CODVEND, APELIDOORDER BY 11FETCH FIRST 10 ROWS ONLY]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA" label="MARCA" type="S" visible="true" useFooter="false"></field>
              <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="PERC" label="PERC" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="PERC_VLR" label="% Valor" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="column" show-tip="false">
                <xField>APELIDO</xField>
                <yField>PERC_VLR</yField>
                <display>
                  <![CDATA[Vendedor]]>
                </display>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hn8u" description="Nivel3_A">
    <args >
      <arg id="A_MARCA" type="text"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="184">
        <grid id="grd_hn5n6c" useNewGrid="S">
          <args>
            <arg id="A_DTREF" type="date"></arg>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[<b>:A_MARCA - Meta por Marca << Vendedor </b>]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECTMARCA, CODVEND, APELIDO, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAGROUP BY MARCA, CODVEND, APELIDOORDER BY 6]]>
          </expression>
          <metadata>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hn8v">
            <param id="A_MARCA">$MARCA</param>
            <param id="A_CODVEND">$CODVEND</param>
            <param id="A_CODPARC">$CODPARC</param>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="H" tamanhoRelativo="343">
          <container orientacao="V" tamanhoRelativo="50">
            <simple-value id="svl_mrdy2e">
              <value-expression>
                <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px; background-color: green; color: white;'>Consolidado Marca</button></div>]]>
              </value-expression>
              <on-click  navigate-to="lvl_hn5o9h">
                <param id="A_MARCA">:A_MARCA</param>
              </on-click>
            </simple-value>
          </container>
          <container orientacao="V" tamanhoRelativo="50">
            <simple-value id="svl_mrdy2g">
              <value-expression>
                <![CDATA[<div style='text-align: center;'><button style='font-weight: bold; padding: 5px 15px; font-size: 12px; background-color: green; color: white;'>Auditoria Valores</button></div>]]>
              </value-expression>
              <on-click  navigate-to="lvl_hn5pc2">
                <param id="A_MARCA">:A_MARCA</param>
              </on-click>
            </simple-value>
          </container>
        </container>
        <container orientacao="H" tamanhoRelativo="1462">
          <chart id="cht_mrdy2c" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Volume </b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN <= 3UNION ALLSELECT9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, 'OUTROS' AS MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>QTDREAL</field>
                <nameField>RAZAOSOCIAL</nameField>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="H" tamanhoRelativo="1256">
          <chart id="cht_mrdy2a" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN <= 3UNION ALLSELECT9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, 'OUTROS' AS MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTCODPARC, RAZAOSOCIAL, MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAGROUP BY CODPARC,RAZAOSOCIAL, MARCA)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>VLR_REAL</field>
                <nameField>RAZAOSOCIAL</nameField>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hn8v" description="Nivel3_B">
    <args >
      <arg id="A_MARCA" type="text"/>
      <arg id="A_CODVEND" type="integer"/>
      <arg id="A_CODPARC" type="integer"/>
    </args>
    <container orientacao="H" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="184">
        <grid id="grd_iyh4x8" useNewGrid="S">
          <args>
            <arg id="A_DTREF" type="date"></arg>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[<b>Meta por Marca << Cliente << Vendedor</b>]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECTMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAAND CODVEND = :A_CODVENDGROUP BYMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIALORDER BY 2 DESC]]>
          </expression>
          <metadata>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="CODPARC" label="Cód. Parc." type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false" mask="#.##0,00">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false" mask="#.##0,00">
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
              </formatter>
              <formatter formula="true">
                <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
              </formatter>
            </field>
          </metadata>
          <on-click  navigate-to="lvl_g8hn8v">
            <param id="A_MARCA"/>
            <param id="A_CODVEND"/>
            <param id="A_CODPARC"/>
          </on-click>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="100">
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_iyh4ya" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Volume </b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAAND CODVEND = :A_CODVENDGROUP BYMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL)WHERE RN <= 3UNION ALLSELECT'OUTROS' AS MARCA, 9999 AS CODVEND, 'OUTROS' AS APELIDO, 9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)/*AND CAB.CODEMP IN :P_EMPRESA*/AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAAND CODVEND = :A_CODVENDGROUP BYMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="CODPARC" label="CODPARC" type="I" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="VLR_REAL" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>QTDREAL</field>
                <nameField>RAZAOSOCIAL</nameField>
              </serie>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <chart id="cht_iyh4yc" type="pizza">
            <title>
              <![CDATA[<b>TOP 3 - Valores</b>]]>
            </title>
            <expression type="sql" data-source="MGEDS">
              <![CDATA[SELECT * FROM(SELECTMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)AND CAB.CODEMP IN :P_EMPRESAAND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAAND CODVEND = :A_CODVENDGROUP BYMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL)WHERE RN <= 3UNION ALLSELECT'OUTROS' AS MARCA, 9999 AS CODVEND, 'OUTROS' AS APELIDO, 9999 AS CODPARC, 'OUTROS' AS RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, SUM(VLR_PREV) AS VLR_PREV, SUM(VLR_REAL) AS VLR_REAL, 4 AS RNFROM(SELECT * FROM(SELECTMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, ROW_NUMBER() OVER (ORDER BY SUM(QTDREAL) DESC) AS RNFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREALFROM TGMMET METLEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCALEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPRODWHEREMET.CODMETA = :P_CODMETAAND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FINAND MET.CODVEND IN :P_CODVENDAND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)AND CAB.CODEMP IN :P_EMPRESAAND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0))WHERE (QTDPREV <> 0 OR QTDREAL <> 0)AND MARCA = :A_MARCAAND CODVEND = :A_CODVENDGROUP BYMARCA, CODVEND, APELIDO, CODPARC, RAZAOSOCIAL)WHERE RN > 3)]]>
            </expression>
            <metadata>
              <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
              <field name="CODVEND" label="CODVEND" type="I" visible="true" useFooter="false"></field>
              <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
              <field name="CODPARC" label="CODPARC" type="F" visible="true" useFooter="false"></field>
              <field name="RAZAOSOCIAL" label="Cliente" type="S" visible="true" useFooter="false"></field>
              <field name="QTDPREV" label="QTDPREV" type="F" visible="true" useFooter="false"></field>
              <field name="QTDREAL" label="QTDREAL" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_PREV" label="VLR_PREV" type="F" visible="true" useFooter="false"></field>
              <field name="VLR_REAL" label="Vlr. Real" type="F" visible="true" useFooter="false"></field>
              <field name="RN" label="RN" type="F" visible="true" useFooter="false"></field>
            </metadata>
            <series>
              <serie type="pizza" labelSize="15">
                <field>VLR_REAL</field>
                <nameField>RAZAOSOCIAL</nameField>
              </serie>
            </series>
          </chart>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_g8hoge" description="Nivel1_A1">
    <args >
      <arg id="A_CODVEND" type="integer"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_g8hoid" useNewGrid="S">
        <expression type="sql" data-source="MGEDS">
          <![CDATA[SELECT CODVEND, APELIDO, CODPARC, RAZAOSOCIAL,MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)  GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0)) WHERE CODVEND = :A_CODVENDAND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY CODVEND, APELIDO, CODPARC, RAZAOSOCIAL,MARCAORDER BY "PERC_VLR" DESC]]>
        </expression>
        <metadata>
          <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
          <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
          <field name="CODPARC" label="Cód. Parc." type="I" visible="true" useFooter="false"></field>
          <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
          <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
          <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
          <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
          <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
            </formatter>
          </field>
          <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
          <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
          <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
            </formatter>
          </field>
        </metadata>
      </grid>
    </container>
  </level>
  <level id="lvl_g8hogf" description="Nivel1_A2">
    <args >
      <arg id="A_CODVEND" type="integer"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="101">
        <grid id="grd_g8hot5" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
            <arg id="A_MARCA" type="text"></arg>
            <arg id="A_CODPARC" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Consolidado por Vendedor]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CODVEND, APELIDO, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0)) WHERECODVEND = :A_CODVENDAND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY CODVEND, APELIDOORDER BY APELIDO ASC, "QTDREAL" DESC]]>
          </expression>
          <metadata>
            <field name="CODVEND" label="Cód. Vendedor" type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
          </metadata>
          <refresh-details  ui-list="grd_g8ho1h">
            <param id="A_CODVEND">$CODVEND</param>
          </refresh-details>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="302">
        <grid id="grd_g8ho1h" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Auditoria do Realizado]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CAB.NUNOTA, CAB.NUMNOTA, CAB.DTMOV , CAB.CODVEND , VEN.APELIDO, CAB.CODPARC, PAR.RAZAOSOCIAL, PRO.MARCA, ITE.CODPROD, PRO.DESCRPROD,    SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.QTDNEG * PRO.AD_QTDVOLLT) *-1 ELSE (ITE.QTDNEG * PRO.AD_QTDVOLLT) END) AS QTD, NVL(PRC.VLRVENDALT,0) AS PRECOLT   , SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS PRECOTOT   , TOP.CODTIPOPER||'-'||TOP.DESCROPER AS TOP   FROM TSIEMP EMP   INNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)   INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)   INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)   INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)   INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)   INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)   LEFT JOIN AD_PRECOMARCA PRC ON (PRO.MARCA = PRC.MARCA AND PRC.DTREF='01/07/2023')  WHERE TOP.ATUALEST <> 'N'       AND TRUNC(CAB.DTMOV,'MONTH') >= :P_PERIODO.INI       AND TRUNC(CAB.DTMOV,'MONTH') <= :P_PERIODO.FIN         AND (CAB.CODVEND = :A_CODVEND OR :A_CODVEND IS NULL)         AND CAB.TIPMOV IN ('V','D')       AND CAB.STATUSNOTA='L'       AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL)       AND PRO.MARCA IS NOT NULL       AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I' ) OR (TOP.CODTIPOPER IN (1112,1113)  ) )AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY CAB.NUNOTA, CAB.NUMNOTA, CAB.DTMOV , CAB.CODVEND , VEN.APELIDO, CAB.CODPARC, PAR.RAZAOSOCIAL, PRO.MARCA, ITE.CODPROD, PRO.DESCRPROD, TOP.CODTIPOPER, TOP.DESCROPER, NVL(PRC.VLRVENDALT,0)]]>
          </expression>
          <metadata>
            <field name="NUNOTA" label="Nro Único" type="I" visible="true" useFooter="false"></field>
            <field name="NUMNOTA" label="Nro Nota" type="I" visible="true" useFooter="false"></field>
            <field name="DTMOV" label="Dt. Movimento" type="D" visible="true" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vendedor" type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="CODPARC" label="Cód. Cliente" type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Razão Social" type="S" visible="true" useFooter="false"></field>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="CODPROD" label="Cód. Produto" type="I" visible="true" useFooter="false"></field>
            <field name="DESCRPROD" label="Produto" type="S" visible="true" useFooter="false"></field>
            <field name="QTD" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PRECOLT" label="Vlr.LT" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            <field name="PRECOTOT" label="Vlr.Tot.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="TOP" label="TOP" type="S" visible="true" useFooter="false"></field>
          </metadata>
          <on-click-launcher  resource-id="br.com.sankhya.com.mov.CentralNotas">
            <NUNOTA>$NUNOTA</NUNOTA>
          </on-click-launcher>
        </grid>
      </container>
    </container>
  </level>
  <level id="lvl_hn5ox1" description="Nivel2_A1">
    <args >
      <arg id="A_CODPARC" type="integer"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_hn5ox3" useNewGrid="S">
        <expression type="sql" data-source="MGEDS">
          <![CDATA[SELECT CODVEND, APELIDO, CODPARC, RAZAOSOCIAL,MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)  GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0)) WHERE CODPARC = :A_CODPARCAND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY CODVEND, APELIDO, CODPARC, RAZAOSOCIAL,MARCAORDER BY "PERC_VLR" DESC]]>
        </expression>
        <metadata>
          <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
          <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
          <field name="CODPARC" label="Cód. Parc." type="I" visible="true" useFooter="false"></field>
          <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
          <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
          <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
          <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
          <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
            </formatter>
          </field>
          <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
          <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
          <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
            </formatter>
          </field>
        </metadata>
      </grid>
    </container>
  </level>
  <level id="lvl_hn5o1d" description="Nivel2_A2">
    <args >
      <arg id="A_CODPARC" type="integer"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="120">
        <grid id="grd_hn5o1f" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
            <arg id="A_MARCA" type="text"></arg>
            <arg id="A_CODPARC" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Consolidado por Vendedor]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CODPARC, RAZAOSOCIAL, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0)) WHERECODPARC = :A_CODPARCAND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYCODPARC, RAZAOSOCIALORDER BY 5 DESC]]>
          </expression>
          <metadata>
            <field name="CODPARC" label="Cód. Parc." type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
          </metadata>
          <refresh-details  ui-list="grd_g8ho1h">
            <param id="A_CODVEND">$CODVEND</param>
          </refresh-details>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="363">
        <grid id="grd_hn5o1h" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Auditoria do Realizado]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CAB.NUNOTA, CAB.NUMNOTA, CAB.DTMOV , CAB.CODVEND , VEN.APELIDO, CAB.CODPARC, PAR.RAZAOSOCIAL, PRO.MARCA, ITE.CODPROD, PRO.DESCRPROD,    SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.QTDNEG * PRO.AD_QTDVOLLT) *-1 ELSE (ITE.QTDNEG * PRO.AD_QTDVOLLT) END) AS QTD, NVL(PRC.VLRVENDALT,0) AS PRECOLT   , SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS PRECOTOT   , TOP.CODTIPOPER||'-'||TOP.DESCROPER AS TOP   FROM TSIEMP EMP   INNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)   INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)   INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)   INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)   INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)   INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)   LEFT JOIN AD_PRECOMARCA PRC ON (PRO.MARCA = PRC.MARCA AND PRC.DTREF='01/07/2023')  WHERE TOP.ATUALEST <> 'N'       AND TRUNC(CAB.DTMOV,'MONTH') >= :P_PERIODO.INI       AND TRUNC(CAB.DTMOV,'MONTH') <= :P_PERIODO.FIN         AND (CAB.CODPARC = :A_CODPARC OR :A_CODPARC IS NULL)         AND CAB.TIPMOV IN ('V','D')       AND CAB.STATUSNOTA='L'       AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL)       AND PRO.MARCA IS NOT NULL       AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I' ) OR (TOP.CODTIPOPER IN (1112,1113)  ) )AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY CAB.NUNOTA, CAB.NUMNOTA, CAB.DTMOV , CAB.CODVEND , VEN.APELIDO, CAB.CODPARC, PAR.RAZAOSOCIAL, PRO.MARCA, ITE.CODPROD, PRO.DESCRPROD, TOP.CODTIPOPER, TOP.DESCROPER, NVL(PRC.VLRVENDALT,0)]]>
          </expression>
          <metadata>
            <field name="NUNOTA" label="Nro Único" type="I" visible="true" useFooter="false"></field>
            <field name="NUMNOTA" label="Nro Nota" type="I" visible="true" useFooter="false"></field>
            <field name="DTMOV" label="Dt. Movimento" type="D" visible="true" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vendedor" type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="CODPARC" label="Cód. Cliente" type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Razão Social" type="S" visible="true" useFooter="false"></field>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="CODPROD" label="Cód. Produto" type="I" visible="true" useFooter="false"></field>
            <field name="DESCRPROD" label="Produto" type="S" visible="true" useFooter="false"></field>
            <field name="QTD" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PRECOLT" label="Vlr.LT" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            <field name="PRECOTOT" label="Vlr.Tot.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="TOP" label="TOP" type="S" visible="true" useFooter="false"></field>
          </metadata>
          <on-click-launcher  resource-id="br.com.sankhya.com.mov.CentralNotas">
            <NUNOTA>$NUNOTA</NUNOTA>
          </on-click-launcher>
        </grid>
      </container>
    </container>
  </level>
  <level id="lvl_hn5o9h" description="Nivel3_A1">
    <args >
      <arg id="A_MARCA" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_hn5o9j" useNewGrid="S">
        <expression type="sql" data-source="MGEDS">
          <![CDATA[SELECT CODVEND, APELIDO, CODPARC, RAZAOSOCIAL,MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)  GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL , NVL(PRC.VLRVENDALT,0)) WHERE MARCA = :A_MARCAAND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BY CODVEND, APELIDO, CODPARC, RAZAOSOCIAL,MARCAORDER BY 8 DESC]]>
        </expression>
        <metadata>
          <field name="CODVEND" label="Cód. Vend." type="I" visible="true" useFooter="false"></field>
          <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
          <field name="CODPARC" label="Cód. Parc." type="I" visible="true" useFooter="false"></field>
          <field name="RAZAOSOCIAL" label="Parceiro" type="S" visible="true" useFooter="false"></field>
          <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
          <field name="QTDPREV" label="Qtd. Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
          <field name="QTDREAL" label="Qtd. Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
          <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false">
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagBlue">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
            </formatter>
          </field>
          <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
          <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field>
          <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false">
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; background-color:#FFFFFF; src:iconFlagBlue">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagGreen">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagYellow">$VALUE</span>]]>
            </formatter>
            <formatter formula="true">
              <![CDATA[<span style="color:#000000; src:iconFlagRed">$VALUE</span>]]>
            </formatter>
          </field>
        </metadata>
      </grid>
    </container>
  </level>
  <level id="lvl_hn5pc2" description="Nivel3_A2">
    <args >
      <arg id="A_MARCA" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="100">
        <grid id="grd_hn5pc4" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
            <arg id="A_MARCA" type="text"></arg>
            <arg id="A_CODPARC" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Consolidado por Vendedor]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT MARCA, SUM(QTDPREV) AS QTDPREV, SUM(QTDREAL) AS QTDREAL, CASE WHEN SUM(QTDPREV) = 0 THEN 100 ELSE SUM(QTDREAL) * 100 / NULLIF(SUM(QTDPREV), 0) END AS PERC, SUM(QTDPREV * PRECOLT)  AS VLR_PREV, SUM(VLRREAL)  AS VLR_REAL, CASE WHEN SUM(QTDPREV * PRECOLT) = 0 THEN 100 ELSE NVL(SUM(VLRREAL) * 100 / NULLIF(SUM(QTDPREV * PRECOLT), 0), 0) END AS PERC_VLRFROM(SELECT MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0) AS PRECOLT, SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS VLRREAL  FROM TGMMET MET  LEFT JOIN TGFVEN VEN ON (MET.CODVEND = VEN.CODVEND)  LEFT JOIN TGFPAR PAR ON (MET.CODPARC = PAR.CODPARC)  LEFT JOIN AD_PRECOMARCA PRC ON (MET.MARCA = PRC.MARCA AND PRC.CODMETA=MET.CODMETA AND PRC.DTREF='01/07/2023')LEFT JOIN TGFCAB CAB ON CAB.CODVEND = VEN.CODVEND AND TRUNC(DTMOV,'MM') = MET.DTREF AND CAB.TIPMOV IN ('V','D') AND CAB.STATUSNOTA='L' AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL) AND CAB.CODPARC = MET.CODPARC AND (SELECT COUNT(TOP.CODTIPOPER) FROM TGFTOP TOP WHERE TOP.CODTIPOPER = CAB.CODTIPOPER AND TOP.DHALTER = (SELECT MAX(DHALTER) FROM TGFTOP WHERE CODTIPOPER = CAB.CODTIPOPER) AND TOP.ATUALEST <> 'N' AND TOP.GOLSINAL = -1 ) > 0    LEFT JOIN TGFPRO PRO ON PRO.MARCA = MET.MARCA  LEFT JOIN TGFITE ITE ON CAB.NUNOTA = ITE.NUNOTA AND PRO.CODPROD = ITE.CODPROD  WHERE 		MET.CODMETA = :P_CODMETA		AND MET.DTREF BETWEEN :P_PERIODO.INI AND :P_PERIODO.FIN         AND MET.CODVEND IN :P_CODVEND		AND (MET.CODPARC = :P_CODPARC OR :P_CODPARC IS NULL)		AND (PRO.MARCA IN (SELECT MARCA FROM TGFPRO WHERE CODPROD IN :P_MARCA))         AND ((:P_NTEMMETA='S' AND (MET.QTDPREV <> 0 OR MET.QTDREAL <> 0)) OR :P_NTEMMETA='N')         AND (PRO.CODGRUPOPROD = :P_GRUPOPROD OR :P_GRUPOPROD IS NULL)         /*AND CAB.CODEMP IN :P_EMPRESA*/         AND (CAB.CODCENCUS = :P_CR OR :P_CR IS NULL)          AND (VEN.CODGER IN :P_CODGER)AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY MET.DTREF, MET.CODVEND, VEN.APELIDO, MET.CODPARC, PAR.RAZAOSOCIAL, MET.MARCA, MET.QTDPREV, MET.QTDREAL, NVL(PRC.VLRVENDALT,0)) WHEREMARCA = :A_MARCAAND (QTDPREV <> 0 OR QTDREAL <> 0)GROUP BYMARCAORDER BY 5 DESC]]>
          </expression>
          <metadata>
            <field name="MARCA" label="MARCA" type="S" visible="true" useFooter="false"></field>
            <field name="QTDPREV" label="Qtd.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="QTDREAL" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC" label="% Qtd." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            <field name="VLR_PREV" label="Vlr.Prev." type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="VLR_REAL" label="Vlr.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PERC_VLR" label="% Vlr." type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
          </metadata>
          <refresh-details  ui-list="grd_g8ho1h">
            <param id="A_CODVEND">$CODVEND</param>
          </refresh-details>
        </grid>
      </container>
      <container orientacao="V" tamanhoRelativo="234">
        <grid id="grd_hn5pc6" useNewGrid="S">
          <args>
            <arg id="A_CODVEND" type="integer"></arg>
          </args>
          <title>
            <![CDATA[Auditoria do Realizado]]>
          </title>
          <expression type="sql" data-source="MGEDS">
            <![CDATA[SELECT CAB.NUNOTA, CAB.NUMNOTA, CAB.DTMOV , CAB.CODVEND , VEN.APELIDO, CAB.CODPARC, PAR.RAZAOSOCIAL, PRO.MARCA, ITE.CODPROD, PRO.DESCRPROD,    SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.QTDNEG * PRO.AD_QTDVOLLT) *-1 ELSE (ITE.QTDNEG * PRO.AD_QTDVOLLT) END) AS QTD, NVL(PRC.VLRVENDALT,0) AS PRECOLT   , SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END)  AS PRECOTOT   , TOP.CODTIPOPER||'-'||TOP.DESCROPER AS TOP   FROM TSIEMP EMP   INNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)   INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)   INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)   INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)   INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)   INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)   LEFT JOIN AD_PRECOMARCA PRC ON (PRO.MARCA = PRC.MARCA AND PRC.DTREF='01/07/2023')  WHERE TOP.ATUALEST <> 'N'       AND TRUNC(CAB.DTMOV,'MONTH') >= :P_PERIODO.INI       AND TRUNC(CAB.DTMOV,'MONTH') <= :P_PERIODO.FIN         /*AND (CAB.CODPARC = :A_CODPARC OR :A_CODPARC IS NULL)  */       AND CAB.TIPMOV IN ('V','D')       AND CAB.STATUSNOTA='L'       AND (CAB.STATUSNFE IN ('A', 'T', 'S') OR CAB.STATUSNFE IS NULL)       AND PRO.MARCA LIKE :A_MARCA /*IS NOT NULL*/       AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I' ) OR (TOP.CODTIPOPER IN (1112,1113)  ) )AND(VEN.CODVEND = (SELECT CODVEND FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) /* CONSULTA VENDEDOR*/OR VEN.CODVEND IN (SELECT VEN.CODVEND FROM TGFVEN VEN, TSIUSU USU WHERE USU.CODVEND = VEN.CODGER AND USU.CODUSU = STP_GET_CODUSULOGADO) /*CONSULTA GERENTE*/OR (SELECT AD_GESTOR_META FROM TSIUSU WHERE CODUSU = STP_GET_CODUSULOGADO) = 'S' /*CONSULTA MASTER*/)GROUP BY CAB.NUNOTA, CAB.NUMNOTA, CAB.DTMOV , CAB.CODVEND , VEN.APELIDO, CAB.CODPARC, PAR.RAZAOSOCIAL, PRO.MARCA, ITE.CODPROD, PRO.DESCRPROD, TOP.CODTIPOPER, TOP.DESCROPER, NVL(PRC.VLRVENDALT,0)]]>
          </expression>
          <metadata>
            <field name="NUNOTA" label="Nro Único" type="I" visible="true" useFooter="false"></field>
            <field name="NUMNOTA" label="Nro Nota" type="I" visible="true" useFooter="false"></field>
            <field name="DTMOV" label="Dt. Movimento" type="D" visible="true" useFooter="false"></field>
            <field name="CODVEND" label="Cód. Vendedor" type="I" visible="true" useFooter="false"></field>
            <field name="APELIDO" label="Vendedor" type="S" visible="true" useFooter="false"></field>
            <field name="CODPARC" label="Cód. Cliente" type="I" visible="true" useFooter="false"></field>
            <field name="RAZAOSOCIAL" label="Razão Social" type="S" visible="true" useFooter="false"></field>
            <field name="MARCA" label="Marca" type="S" visible="true" useFooter="false"></field>
            <field name="CODPROD" label="Cód. Produto" type="I" visible="true" useFooter="false"></field>
            <field name="DESCRPROD" label="Produto" type="S" visible="true" useFooter="false"></field>
            <field name="QTD" label="Qtd.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="PRECOLT" label="Vlr.LT" type="F" visible="true" useFooter="false" mask="#.##0,00"></field>
            <field name="PRECOTOT" label="Vlr.Tot.Real" type="F" visible="true" useFooter="SUM" mask="#.##0,00"></field>
            <field name="TOP" label="TOP" type="S" visible="true" useFooter="false"></field>
          </metadata>
          <on-click-launcher  resource-id="br.com.sankhya.com.mov.CentralNotas">
            <NUNOTA>$NUNOTA</NUNOTA>
          </on-click-launcher>
        </grid>
      </container>
    </container>
  </level>
</gadget>