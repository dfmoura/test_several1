<gadget>
  <prompt-parameters>
    <parameter id="P_PERIODO" description="Periodo" metadata="singleList:Text" listType="sql" required="false" keep-last="true" keep-date="false" order="1">
      <expression type="SQL"><![CDATA[SELECTTO_CHAR(DTMOV,'YYYY') AS VALUE,TO_CHAR(DTMOV,'YYYY') AS LABELFROM TGFCABGROUP BYTO_CHAR(DTMOV,'YYYY')ORDER BYTO_CHAR(DTMOV,'YYYY') DESC]]></expression>
    </parameter>
    <parameter id="P_LINHABIO" description="Desconsiderar Linha Bio no Faturamento" metadata="boolean" required="false" keep-last="true" keep-date="false" default="false" order="2"/>
  </prompt-parameters>
  <level id="lvl_aj3y70r" description="Principal">
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="H" tamanhoRelativo="261">
        <container orientacao="V" tamanhoRelativo="311">
          <chart id="cht_apxkdrj" type="line" nroColuna="12">
            <title><![CDATA[<b>EVOLUÇÃO REAL x PREVISTO >>> :P_PERIODO</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTANO,MES,MES_ANO,PREV,REALFROM(SELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END)AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANO)GROUP BY ANO,MES,MES_ANO,PREV,REALORDER BY ANO,MES]]></expression>
            <metadata>
              <field name="ANO" label="ANO" type="S" visible="true" useFooter="false"/>
              <field name="MES" label="MES" type="S" visible="true" useFooter="false"/>
              <field name="MES_ANO" label="Mês / Ano" type="S" visible="true" useFooter="false"/>
              <field name="PREV" label="Previsto" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              <field name="REAL" label="Real" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            </metadata>
            <horizontal-axis>
              <category field="MES_ANO" rotation="-53" dropLabel="false">
                <initView value="first"/>
              </category>
            </horizontal-axis>
            <series>
              <serie type="line" circle-intersection="true">
                <xField>MES_ANO</xField>
                <yField>PREV</yField>
                <display><![CDATA[Previsto]]></display>
                <color>0xff0000</color>
              </serie>
              <serie type="line" circle-intersection="true">
                <xField>MES_ANO</xField>
                <yField>REAL</yField>
                <display><![CDATA[Real]]></display>
                <color>0xcc</color>
              </serie>
            </series>
            <legend position="top" direction="v"/>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="100">
          <chart id="cht_apxkdwp" type="gauge">
            <title><![CDATA[<b>% de Atendimento Orçamento</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCASE WHEN ABS(SUM(PREV)) = 0 THEN 100 ELSE ABS(SUM(REAL)) * 100 / NULLIF(ABS(SUM(PREV)), 0) END AS PERC_ATINGIDOFROM(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)---LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY')  = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY'))]]></expression>
            <metadata>
              <field name="PERC_ATINGIDO" label="% Atingido" type="F" visible="true" useFooter="false"/>
            </metadata>
            <show-ticks>true</show-ticks>
            <min-value>0</min-value>
            <max-value>100</max-value>
            <value-field>PERC_ATINGIDO</value-field>
            <alert-colors values="0,30,50,70,90,100" colors="0xff00,0xff9900,0xffff,0xff,0xff0000"/>
          </chart>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="422">
        <container orientacao="V" tamanhoRelativo="116">
          <chart id="cht_apxkdym" type="column" nroColuna="10">
            <title><![CDATA[<b>Naturezas com REAL maior que PREVISTO</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODNAT,ABS(SUM(PREV)) AS PREV,ABS(SUM(REAL)) AS REALFROM(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT MET.CODNAT,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYMET.CODNATUNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTCAB.CODNAT,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)---LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY')  = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYCAB.CODNATUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTFIN.CODNAT,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYFIN.CODNAT)WHERE ABS(REAL) > ABS(PREV) AND ROWNUM <= 10GROUP BY CODNATORDER BY ABS(REAL)DESC]]></expression>
            <metadata>
              <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
              <field name="PREV" label="Previsto" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              <field name="REAL" label="Real" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            </metadata>
            <horizontal-axis>
              <category field="CODNAT" rotation="-47" dropLabel="false">
                <initView value="first"/>
                <title>Natureza</title>
              </category>
            </horizontal-axis>
            <series>
              <set type="stacked">
                <serie type="column">
                  <xField>CODNAT</xField>
                  <yField>PREV</yField>
                  <display><![CDATA[Previsto]]></display>
                  <color>0xff0000</color>
                </serie>
                <serie type="column">
                  <xField>CODNAT</xField>
                  <yField>REAL</yField>
                  <display><![CDATA[Real]]></display>
                  <color>0xff</color>
                </serie>
              </set>
            </series>
          </chart>
        </container>
        <container orientacao="V" tamanhoRelativo="100">
          <chart id="cht_aquvtyb" type="column" nroColuna="6">
            <title><![CDATA[<b>TA 30% PARA ATINGIR PREVISTO</b>]]></title>
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODNAT,ABS(SUM(PREV)) AS PREV,ABS(SUM(REAL)) AS REALFROM(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT MET.CODNAT,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYMET.CODNATUNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTCAB.CODNAT,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)---LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY')  = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYCAB.CODNATUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTFIN.CODNAT,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYFIN.CODNAT)WHERE ABS(PREV) > 0 AND REAL/PREV BETWEEN 0.7 AND 1GROUP BY CODNATORDER BY CODNAT]]></expression>
            <metadata>
              <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
              <field name="PREV" label="Previsto" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              <field name="REAL" label="Real" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
            </metadata>
            <horizontal-axis>
              <category field="CODNAT" rotation="-45" dropLabel="false">
                <initView value="first"/>
              </category>
            </horizontal-axis>
            <series>
              <serie type="column">
                <xField>CODNAT</xField>
                <yField>PREV</yField>
                <display><![CDATA[Previsto]]></display>
                <color>0xff0000</color>
              </serie>
              <serie type="column">
                <xField>CODNAT</xField>
                <yField>REAL</yField>
                <display><![CDATA[Real]]></display>
                <color>0xff</color>
              </serie>
            </series>
            <legend position="top" direction="v"/>
          </chart>
        </container>
      </container>
      <container orientacao="H" tamanhoRelativo="100">
        <container orientacao="V" tamanhoRelativo="50">
          <simple-value id="svl_apxkdyl">
            <value-expression><![CDATA[<div style='text-align: center;'><button style="background-color: #4CAF50; color: white; padding: 10px;">Análise do Orçamento</button></div>]]></value-expression>
            <on-click navigate-to="lvl_apxkdqg"/>
          </simple-value>
        </container>
        <container orientacao="V" tamanhoRelativo="50">
          <simple-value id="svl_apxkdy8">
            <value-expression><![CDATA[<div style='text-align: center;'><button style="background-color: #4CAF50; color: white; padding: 10px;">Comparação do Orçamento</button></div>]]></value-expression>
          </simple-value>
        </container>
      </container>
    </container>
  </level>
  <level id="lvl_apxkdqg" description="Nivel1">
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_apxkdqt" useNewGrid="S">
        <expression type="sql" data-source="MGEDS"><![CDATA[SELECTCODIGO1,DESCRICAO,GRAU,MAX(CASE WHEN MES = '01' THEN PREV END) AS "JAN_P",MAX(CASE WHEN MES = '01' THEN REAL END) AS "JAN_R",MAX(CASE WHEN MES = '01' THEN PERC END) AS "JAN_PERC",MAX(CASE WHEN MES = '02' THEN PREV END) AS "FEV_P",MAX(CASE WHEN MES = '02' THEN REAL END) AS "FEV_R",MAX(CASE WHEN MES = '02' THEN PERC END) AS "FEV_PERC",MAX(CASE WHEN MES = '03' THEN PREV END) AS "MAR_P",MAX(CASE WHEN MES = '03' THEN REAL END) AS "MAR_R",MAX(CASE WHEN MES = '03' THEN PERC END) AS "MAR_PERC",MAX(CASE WHEN MES = '04' THEN PREV END) AS "ABR_P",MAX(CASE WHEN MES = '04' THEN REAL END) AS "ABR_R",MAX(CASE WHEN MES = '04' THEN PERC END) AS "ABR_PERC",MAX(CASE WHEN MES = '05' THEN PREV END) AS "MAI_P",MAX(CASE WHEN MES = '05' THEN REAL END) AS "MAI_R",MAX(CASE WHEN MES = '05' THEN PERC END) AS "MAI_PERC",MAX(CASE WHEN MES = '06' THEN PREV END) AS "JUN_P",MAX(CASE WHEN MES = '06' THEN REAL END) AS "JUN_R",MAX(CASE WHEN MES = '06' THEN PERC END) AS "JUN_PERC",MAX(CASE WHEN MES = '07' THEN PREV END) AS "JUL_P",MAX(CASE WHEN MES = '07' THEN REAL END) AS "JUL_R",MAX(CASE WHEN MES = '07' THEN PERC END) AS "JUL_PERC",MAX(CASE WHEN MES = '08' THEN PREV END) AS "AGO_P",MAX(CASE WHEN MES = '08' THEN REAL END) AS "AGO_R",MAX(CASE WHEN MES = '08' THEN PERC END) AS "AGO_PERC",MAX(CASE WHEN MES = '09' THEN PREV END) AS "SET_P",MAX(CASE WHEN MES = '09' THEN REAL END) AS "SET_R",MAX(CASE WHEN MES = '09' THEN PERC END) AS "SET_PERC",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_P",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_R",MAX(CASE WHEN MES = '10' THEN PERC END) AS "OUT_PERC",MAX(CASE WHEN MES = '11' THEN PREV END) AS "NOV_P",MAX(CASE WHEN MES = '11' THEN REAL END) AS "NOV_R",MAX(CASE WHEN MES = '11' THEN PERC END) AS "NOV_PERC",MAX(CASE WHEN MES = '12' THEN PREV END) AS "DEZ_P",MAX(CASE WHEN MES = '12' THEN REAL END) AS "DEZ_R",MAX(CASE WHEN MES = '12' THEN PERC END) AS "DEZ_PERC",CASE WHEN GRAU = 1 THEN '#8EA9DB' WHEN GRAU = 2 THEN '#c6d4ed'WHEN GRAU = 3 THEN '#dde5f4'WHEN GRAU = 4 THEN '#e8f5cc'WHEN GRAU = 5 THEN '#f0eaf5'WHEN GRAU IS NULL THEN '#2e34db'END AS BKCOLOR,CASE WHEN GRAU IS NULL THEN '#fafafc'END AS FGCOLORFROM(WITH B AS (SELECT LPAD(CODIGO, 10, '0') AS CODIGO1, DESCRICAO,GRAU FROM AD_ORCFIN)SELECTA.ANO,A.MES,A.MES_ANO,A.CODIGO1,CASEWHEN A.CODIGO1 LIKE '0499999999' THEN 'MARGEM DE CONTRIBUIÇÃO'WHEN A.CODIGO1 LIKE '0599999999' THEN 'LUCRO OPERACIONAL ANTES DOS INVESTIMENTOS'WHEN A.CODIGO1 LIKE '0699999998' THEN 'DESPESA OPERACIONAL TOTAL'WHEN A.CODIGO1 LIKE '0699999999' THEN 'LUCRO OPERACIONAL'WHEN A.CODIGO1 LIKE '0799999999' THEN 'RESULTADO LÍQUIDO'WHEN A.CODIGO1 LIKE '0899999998' THEN 'DISTRIBUIÇÃO PARA SÓCIOS'WHEN A.CODIGO1 LIKE '0899999999' THEN 'REINVESTIMENTO GRUPO SATIS'ELSE B.DESCRICAO END AS DESCRICAO, B.GRAU,A.PREV,A.REAL,(A.REAL / MAX(A.REAL) OVER (PARTITION BY A.MES))*100 AS PERCFROM(SELECTANO,MES,MES_ANO,GRAU,CODIGO1,SUM(PREV) AS PREV,SUM(REAL) AS REALFROM(WITH BAS AS(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANO,GRAU,CODIGO1UNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0499999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FININNER JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATINNER JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0599999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) + SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) +SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0699999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0799999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999998' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANOUNION ALLSELECTANO,MES,MES_ANO,'TOTAL' AS GRAU, '0899999999' AS CODIGO1,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN PREV END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN PREV END)AS PREV,SUM(CASE WHEN CODIGO1 LIKE '0300000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0400000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) - SUM(CASE WHEN CODIGO1 LIKE '0500000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0600000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0700000000' AND GRAU LIKE 'GRAU 1' THEN REAL END) -SUM(CASE WHEN CODIGO1 LIKE '0800000000' AND GRAU LIKE 'GRAU 1' THEN REAL END)AS REALFROM(WITH BAS AS(/*PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYTO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY'),ORC.CODIGOUNION ALL/*REAL DA DESPESA VGF_RESULTADO_SATIS DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,'GRAU 1' AS GRAU,PREV AS PREV,REAL AS REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)GROUP BY ANO,MES,MES_ANO) ALEFT JOIN B ON A.CODIGO1 = B.CODIGO1WHERE A.CODIGO1 NOT IN ('00','0000','000000','00000000')GROUP BYA.ANO,A.MES,A.MES_ANO,A.CODIGO1,B.DESCRICAO,B.GRAU, A.PREV,A.REAL)GROUP BY CODIGO1,DESCRICAO,GRAUORDER BY CODIGO1

]]></expression>
        <metadata>
          <field name="CODIGO1" label="Código" type="S" visible="true" useFooter="false"/>
          <field name="DESCRICAO" label="Descrição" type="S" visible="true" useFooter="false"/>
          <field name="GRAU" label="Grau" type="S" visible="true" useFooter="false"/>
          <field name="JAN_P" label="JAN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JAN_R" label="JAN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JAN_PERC" label="JAN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="FEV_P" label="FEV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="FEV_R" label="FEV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="FEV_PERC" label="FEV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="MAR_P" label="MAR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAR_R" label="MAR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAR_PERC" label="MAR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="ABR_P" label="ABR. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="ABR_R" label="ABR. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="ABR_PERC" label="ABR. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="MAI_P" label="MAI. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAI_R" label="MAI. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="MAI_PERC" label="MAI. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="JUN_P" label="JUN. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUN_R" label="JUN. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUN_PERC" label="JUN. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="JUL_P" label="JUL. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUL_R" label="JUL. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="JUL_PERC" label="JUL. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="AGO_P" label="AGO. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="AGO_R" label="AGO. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="AGO_PERC" label="AGO. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="SET_P" label="SET. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="SET_R" label="SET. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="SET_PERC" label="SET. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="OUT_P" label="OUT. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="OUT_R" label="OUT. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="OUT_PERC" label="OUT. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="NOV_P" label="NOV. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="NOV_R" label="NOV. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="NOV_PERC" label="NOV. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="DEZ_P" label="DEZ. PREV" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="DEZ_R" label="DEZ. REAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
          <field name="DEZ_PERC" label="DEZ. ICM" type="F" visible="true" useFooter="false" mask="#.##0,00 %"/>
          <field name="BKCOLOR" label="BKCOLOR" type="S" visible="true" useFooter="false"/>
          <field name="FGCOLOR" label="FGCOLOR" type="S" visible="true" useFooter="false"/>
        </metadata>
        <on-click navigate-to="lvl_asj889p">
          <param id="A_CODIGO">$CODIGO1</param>
        </on-click>
      </grid>
    </container>
  </level>
  <level id="lvl_asj889p" description="Nivel 2">
    <args>
      <arg id="A_CODIGO" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_asj889q" useNewGrid="S">
        <expression type="sql" data-source="MGEDS"><![CDATA[WITH B AS (SELECT LPAD(CODIGO, 10, '0') AS CODIGO1, DESCRICAO,GRAU FROM AD_ORCFIN),NAT AS (SELECT CODNAT,DESCRNAT FROM TGFNAT),CRE AS (SELECT CODCENCUS, DESCRCENCUS FROM TSICUS),PROJ AS (SELECT CODPROJ, IDENTIFICACAO FROM TCSPRJ)SELECTA.CODNAT,NAT.DESCRNAT, A.CODCENCUS,CRE.DESCRCENCUS, A.CODPROJ,PROJ.IDENTIFICACAO,MAX(CASE WHEN MES = '01' THEN PREV END) AS "JAN_P",MAX(CASE WHEN MES = '01' THEN REAL END) AS "JAN_R",MAX(CASE WHEN MES = '02' THEN PREV END) AS "FEV_P",MAX(CASE WHEN MES = '02' THEN REAL END) AS "FEV_R",MAX(CASE WHEN MES = '03' THEN PREV END) AS "MAR_P",MAX(CASE WHEN MES = '03' THEN REAL END) AS "MAR_R",MAX(CASE WHEN MES = '04' THEN PREV END) AS "ABR_P",MAX(CASE WHEN MES = '04' THEN REAL END) AS "ABR_R",MAX(CASE WHEN MES = '05' THEN PREV END) AS "MAI_P",MAX(CASE WHEN MES = '05' THEN REAL END) AS "MAI_R",MAX(CASE WHEN MES = '06' THEN PREV END) AS "JUN_P",MAX(CASE WHEN MES = '06' THEN REAL END) AS "JUN_R",MAX(CASE WHEN MES = '07' THEN PREV END) AS "JUL_P",MAX(CASE WHEN MES = '07' THEN REAL END) AS "JUL_R",MAX(CASE WHEN MES = '08' THEN PREV END) AS "AGO_P",MAX(CASE WHEN MES = '08' THEN REAL END) AS "AGO_R",MAX(CASE WHEN MES = '09' THEN PREV END) AS "SET_P",MAX(CASE WHEN MES = '09' THEN REAL END) AS "SET_R",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_P",MAX(CASE WHEN MES = '10' THEN PREV END) AS "OUT_R",MAX(CASE WHEN MES = '11' THEN PREV END) AS "NOV_P",MAX(CASE WHEN MES = '11' THEN REAL END) AS "NOV_R",MAX(CASE WHEN MES = '12' THEN PREV END) AS "DEZ_P",MAX(CASE WHEN MES = '12' THEN REAL END) AS "DEZ_R"FROM(WITH BAS AS(/*RECUPERAR VALOR PREVISTO BASEADO NA TGFMET*/SELECT ORC.CODIGO,DET.CODNAT,0 AS CODCENCUS,0 AS CODPROJ,TO_CHAR(DTREF,'YYYY') AS ANO,TO_CHAR(DTREF,'MM') AS MES,TO_CHAR(DTREF,'MM-YYYY') AS MES_ANO,SUM(PREVREC - PREVDESP) AS PREV,0 AS REALFROM AD_ORCFIN ORCINNER JOIN AD_ORCFINDET DET ON ORC.CODIGO = DET.CODIGOINNER JOIN TGFMET MET ON DET.CODNAT = MET.CODNATWHERE CODMETA = 7 AND TO_CHAR(DTREF,'YYYY') = :P_PERIODOGROUP BYORC.CODIGO,DET.CODNAT,TO_CHAR(DTREF,'YYYY'),TO_CHAR(DTREF,'MM'),TO_CHAR(DTREF,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL SOMENTE PARTE DO FATURAMENTO*/SELECTORC.CODIGO,CAB.CODNAT,CAB.CODCENCUS,CAB.CODPROJ,TO_CHAR(DTMOV,'YYYY') AS ANO,TO_CHAR(DTMOV,'MM') AS MES,TO_CHAR(DTMOV,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(CASE WHEN CAB.TIPMOV='D' THEN (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED)*-1 ELSE (ITE.VLRTOT-ITE.VLRDESC-ITE.VLRREPRED) END) AS REALFROM TSIEMP EMPINNER JOIN TGFCAB CAB ON (EMP.CODEMP = CAB.CODEMP)INNER JOIN TGFVEN VEN ON (CAB.CODVEND = VEN.CODVEND)INNER JOIN TGFPAR PAR ON (CAB.CODPARC = PAR.CODPARC)INNER JOIN TGFITE ITE ON (CAB.NUNOTA = ITE.NUNOTA)INNER JOIN TGFPRO PRO ON (ITE.CODPROD = PRO.CODPROD)INNER JOIN TGFTOP TOP ON (CAB.CODTIPOPER = TOP.CODTIPOPER AND CAB.DHTIPOPER = TOP.DHALTER)/*LEFT JOIN AD_ITENSGRUPOSATIS GRUS ON (GRUS.CODPROD=PRO.CODPROD AND $P{GRUPOSATIS} IS NOT NULL)*/INNER JOIN AD_ORCFIN ORC ON (ORC.TIPOMOV = CAB.TIPMOV OR ORC.TIPOMOV = 'A') AND ORC.CALCFAT = 'S'INNER JOIN AD_ORCFINDET DET ON DET.CODIGO = ORC.CODIGO AND DET.CODNAT = CAB.CODNATWHERE(TOP.ATUALEST <> 'N' OR TOP.CODTIPOPER = 1112)AND CAB.TIPMOV IN ('V','D')AND CAB.STATUSNOTA='L'AND (CAB.STATUSNFE = 'A' OR CAB.STATUSNFE = 'T'  OR CAB.STATUSNFE = 'S' OR CAB.STATUSNFE IS NULL)AND ((TOP.ATUALFIN<>0 AND TOP.TIPATUALFIN='I') OR (TOP.CODTIPOPER IN (1112,1113)))AND ORC.CODIGO IS NOT NULLAND TO_CHAR(CAB.DTMOV,'YYYY') = :P_PERIODOAND (ORC.MARCA = PRO.MARCA OR ORC.MARCA IS NULL)AND ((:P_LINHABIO = 'S' AND PRO.CODGRUPOPROD <> 1020000) OR (:P_LINHABIO = 'N'))GROUP BYORC.CODIGO,CAB.CODNAT,CAB.CODCENCUS,CAB.CODPROJ,TO_CHAR(DTMOV,'YYYY'),TO_CHAR(DTMOV,'MM'),TO_CHAR(DTMOV,'MM-YYYY')UNION ALL/*RECUPERAR VALOR REAL DA DESPESA COM BASE NA VGF_RESULTADO_SATIS = DHBAIXA IS NOT NULL*/SELECTORC.CODIGO,FIN.CODNAT,FIN.CODCENCUS,FIN.CODPROJ,TO_CHAR(FIN.DHBAIXA,'YYYY') AS ANO,TO_CHAR(FIN.DHBAIXA,'MM') AS MES,TO_CHAR(FIN.DHBAIXA,'MM-YYYY') AS MES_ANO,0 AS PREV,SUM(FIN.VLRBAIXA * FIN.RECDESP) AS REALFROM VGF_RESULTADO_SATIS FINLEFT JOIN AD_ORCFINDET DET ON FIN.CODNAT = DET.CODNATLEFT JOIN AD_ORCFIN ORC ON DET.CODIGO = ORC.CODIGOWHERE FIN.DHBAIXA IS NOT NULLAND TO_CHAR(FIN.DHBAIXA,'YYYY') = :P_PERIODOAND (NVL(ORC.CALCFAT,'N') = 'N')GROUP BYORC.CODIGO,FIN.CODNAT,FIN.CODCENCUS,FIN.CODPROJ,TO_CHAR(FIN.DHBAIXA,'YYYY'),TO_CHAR(FIN.DHBAIXA,'MM'),TO_CHAR(FIN.DHBAIXA,'MM-YYYY')),GRAU1 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 1' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 2)||'00000000',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU2 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 2' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 4)||'000000',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU3 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 3' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 6)||'0000',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU4 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00' AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 4' AS GRAU,PREV,REALFROM BASGROUP BYANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 8)||'00',CODNAT, CODCENCUS, CODPROJ,PREV,REAL),GRAU5 AS (SELECTANO,MES,MES_ANO,SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10) AS CODIGO1,CODNAT,CODCENCUS,CODPROJ,'GRAU 5' AS GRAU,PREV,REALFROM BASGROUP BYANO, MES, MES_ANO, SUBSTR(LPAD(CODIGO, 10, '0'), 1, 10), CODNAT, CODCENCUS, CODPROJ,PREV, REAL)SELECT * FROM GRAU1UNION ALLSELECT * FROM GRAU2UNION ALLSELECT * FROM GRAU3UNION ALLSELECT * FROM GRAU4UNION ALLSELECT * FROM GRAU5)ALEFT JOIN B ON A.CODIGO1 = B.CODIGO1INNER JOIN NAT ON A.CODNAT = NAT.CODNATINNER JOIN CRE ON A.CODCENCUS = CRE.CODCENCUSINNER JOIN PROJ ON A.CODPROJ = PROJ.CODPROJWHERE A.CODIGO1 NOT IN ('00','0000','000000','00000000')AND A.CODIGO1 = :A_CODIGOGROUP BYA.CODNAT,NAT.DESCRNAT, A.CODCENCUS,CRE.DESCRCENCUS, A.CODPROJ,PROJ.IDENTIFICACAOORDER BY A.CODNAT
]]></expression>
        <metadata>
          <field name="CODNAT" label="Cód. Nat." type="I" visible="true" useFooter="false"/>
          <field name="DESCRNAT" label="DESCRNAT" type="S" visible="true" useFooter="false"/>
          <field name="CODCENCUS" label="Cód. CR" type="I" visible="true" useFooter="false"/>
          <field name="DESCRCENCUS" label="DESCRCENCUS" type="S" visible="true" useFooter="false"/>
          <field name="CODPROJ" label="Cód. Proj." type="I" visible="true" useFooter="false"/>
          <field name="IDENTIFICACAO" label="IDENTIFICACAO" type="S" visible="true" useFooter="false"/>
          <field name="JAN_P" label="JAN PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="JAN_R" label="JAN REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="FEV_P" label="FEV PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="FEV_R" label="FEV REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="MAR_P" label="MAR PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="MAR_R" label="MAR REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="ABR_P" label="ABR PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="ABR_R" label="ABR REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="MAI_P" label="MAI PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="MAI_R" label="MAI PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="JUN_P" label="JUN PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="JUN_R" label="JUN REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="JUL_P" label="JUL PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="JUL_R" label="JUL REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="AGO_P" label="AGO PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="AGO_R" label="AGO REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="SET_P" label="SET PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="SET_R" label="SET REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="OUT_P" label="OUT PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="OUT_R" label="OUT REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="NOV_P" label="NOV PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="NOV_R" label="NOV REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="DEZ_P" label="DEZ PREV" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
          <field name="DEZ_R" label="DEZ REAL" type="F" visible="true" useFooter="SUM" mask="#.##0,00"/>
        </metadata>
      </grid>
    </container>
  </level>
</gadget>